import{g as q,f as H,a as ae,b as V,u as C,c as F,j as e,s as ee,d as ne,e as _,X as Y,h as fe,i as pe,k as ye,l as oe,m as X,n as $,o as re,p as G,r as ve,q as be,t as je,S as W,v as Ne}from"./index-BOcMPlv2.js";import{b as h,e as L,B as U,X as O,Y as J,T as ie,f as T,C as E,L as le,h as ce,i as de,D as z}from"./recharts-DVTnlDRN.js";function ue(t){const s=new Date(t);s.setHours(0,0,0,0),s.setDate(s.getDate()+4-(s.getDay()||7));const a=new Date(s.getFullYear(),0,1),o=Math.ceil(((s.getTime()-a.getTime())/864e5+1)/7);return{year:s.getFullYear(),week:o}}function Ce(t,s){const a=new Date(t,0,1+(s-1)*7),o=a.getDay(),n=a;return o<=4?n.setDate(a.getDate()-a.getDay()+1):n.setDate(a.getDate()+8-a.getDay()),n}function we(t){const{year:s,week:a}=ue(t);return`${s}-W${String(a).padStart(2,"0")}`}function P(t=8){const s=[],a=new Date;for(let o=t-1;o>=0;o--){const n=new Date(a);n.setDate(n.getDate()-o*7);const r=we(n),u=Ce(n.getFullYear(),ue(n).week),l=new Date(u);l.setDate(l.getDate()+6),s.find(m=>m.key===r)||s.push({key:r,start:u,end:l})}return s}function me(t,s){const a=new Date;a.setHours(0,0,0,0);const o=new Date(t);o.setHours(0,0,0,0);const n=a.getTime()-o.getTime(),r=Math.floor(n/864e5)+1;return Math.max(1,Math.min(7,r))}function xe(t,s,a){const o=new Date(t.date+"T00:00:00");return o>=s&&o<=a}function ke(t,s,a){const o=H(t,"food"),n=ae(s,"food");return a.map(r=>{const u=o.filter(i=>xe(i,r.start,r.end)),l=new Map;u.forEach(i=>{V(i,s).forEach(x=>{const g=q(x,s),v=n.find(p=>p.id===x)?.sentiment??"neutral";l.has(x)||l.set(x,{categoryId:x,categoryName:g,sentiment:v,count:0});const b=l.get(x);b.count+=1})});const m=Array.from(l.values()),d={positive:m.filter(i=>i.sentiment==="positive").reduce((i,c)=>i+c.count,0),neutral:m.filter(i=>i.sentiment==="neutral").reduce((i,c)=>i+c.count,0),limit:m.filter(i=>i.sentiment==="limit").reduce((i,c)=>i+c.count,0)};return{weekKey:r.key,start:r.start,end:r.end,entries:u,totalCount:u.length,categories:m,sentimentCounts:d,hasLowData:u.length<5}})}function te(t){const{positive:s,limit:a}=t.sentimentCounts;return s+a===0?0:s/(s+a)*100}function Me(t,s){if(s===0)return{direction:"stable",percentChange:0};const a=(t-s)/s*100;return Math.abs(a)<1?{direction:"stable",percentChange:0}:{direction:a>0?"up":"down",percentChange:Math.round(Math.abs(a))}}function De(t,s=9){const a=new Map;return t.forEach(o=>{o.categories.forEach(n=>{a.set(n.categoryId,(a.get(n.categoryId)||0)+n.count)})}),Array.from(a.entries()).sort((o,n)=>n[1]-o[1]).slice(0,s).map(([o])=>o)}function Se(){if(typeof document>"u")return["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#f97316","#6366f1"];const t=getComputedStyle(document.documentElement);return[t.getPropertyValue("--chart-color-1").trim(),t.getPropertyValue("--chart-color-2").trim(),t.getPropertyValue("--chart-color-3").trim(),t.getPropertyValue("--chart-color-4").trim(),t.getPropertyValue("--chart-color-5").trim(),t.getPropertyValue("--chart-color-6").trim(),t.getPropertyValue("--chart-color-7").trim(),t.getPropertyValue("--chart-color-8").trim(),t.getPropertyValue("--chart-color-9").trim()]}function Ie(t){const s=Se(),a=new Map;return t.forEach((o,n)=>{a.set(o,s[n%s.length])}),a.set("OTHER","var(--color-neutral)"),a}function Te(t,s){const a=[];let o=0;return t.categories.forEach(n=>{s.includes(n.categoryId)?a.push(n):o+=n.count}),o>0&&a.push({categoryId:"OTHER",categoryName:"Other",sentiment:"neutral",count:o}),a.sort((n,r)=>{const u=s.indexOf(n.categoryId),l=s.indexOf(r.categoryId);return u===-1?1:l===-1?-1:u-l})}function he(t,s,a,o){const n=ae(s,"food"),r=new Set(n.filter(x=>x.sentiment===o).map(x=>x.id)),u=new Map;let l=0;if(r.size===0)return{counts:u,total:l,catIds:r};const m=a.slice(-4),d=m[0].start,i=m[m.length-1].end,c=H(t,"food").filter(x=>xe(x,d,i));for(const x of c){const g=V(x,s);for(const f of g)r.has(f)&&(u.set(f,(u.get(f)||0)+1),l++)}return{counts:u,total:l,catIds:r}}function ge(t){const s=t.match(/W(\d+)$/);return s?parseInt(s[1],10):0}function Ee(t,s,a){const o=["M","T","W","T","F","S","S"],n=[0,0,0,0,0,0,0];for(const r of t){const u=new Date(r.date+"T00:00:00");if(u>=s&&u<=a){const l=u.getDay(),m=l===0?6:l-1;n[m]++}}return o.map((r,u)=>({day:r,count:n[u]}))}function Le(t,s,a,o=5){const{counts:n,total:r}=he(t,s,a,"limit");return r===0?[]:Array.from(n.entries()).sort((u,l)=>l[1]-u[1]).slice(0,o).map(([u,l])=>{const m=Math.round(l/r*100),d=q(u,s);return{categoryId:u,categoryName:d,value:m,label:`${m}% of limit total`,count:l}})}function Ae(t,s,a,o=5){const{counts:n,total:r,catIds:u}=he(t,s,a,"positive");if(r===0)return[];for(const m of u)n.has(m)||n.set(m,0);const l=1/u.size;return Array.from(n.entries()).map(([m,d])=>{const i=d/r,c=l-i;return{catId:m,count:d,share:i,gap:c}}).filter(m=>m.gap>0).sort((m,d)=>d.gap-m.gap).slice(0,o).map(m=>{const d=q(m.catId,s),i=Math.round(m.gap*100);return{categoryId:m.catId,categoryName:d,value:i,label:"Below your positive average"}})}function Q(t=640){const s=h.useCallback(o=>{const n=window.matchMedia(`(max-width: ${t-1}px)`);return n.addEventListener("change",o),()=>n.removeEventListener("change",o)},[t]),a=h.useCallback(()=>window.matchMedia(`(max-width: ${t-1}px)`).matches,[t]);return h.useSyncExternalStore(s,a,()=>!1)}function We({weeklyData:t}){const{t:s}=C("stats"),a=h.useMemo(()=>t.map(l=>{const{positive:m,neutral:d,limit:i}=l.sentimentCounts,c=m+d+i;return{week:F(l.start),positive:c>0?m/c*100:0,neutral:c>0?d/c*100:0,limit:c>0?i/c*100:0,opacity:l.hasLowData?.4:1}}),[t]),o=h.useMemo(()=>t.length===0?0:te(t[t.length-1]),[t]),n=h.useMemo(()=>t.length<2?o:te(t[t.length-2]),[t,o]),r=h.useMemo(()=>Me(o,n),[o,n]),u=Q();return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("balanceOverview.scoreTitle")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-4xl font-bold",style:{color:"var(--color-activity)"},children:[Math.round(o),"%"]}),r.direction!=="stable"&&e.jsxs("div",{className:"text-sm font-semibold flex items-center gap-1",style:{color:r.direction==="up"?"var(--color-success)":"var(--color-danger)"},children:[e.jsx("span",{children:r.direction==="up"?"↑":"↓"}),e.jsxs("span",{children:[r.percentChange,"%"]})]})]})]}),e.jsx("div",{className:"bg-[var(--bg-inset)] rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${o}%`,background:"linear-gradient(to right, var(--color-danger), var(--color-warning), var(--color-success))"}})}),e.jsx("p",{className:"text-xs text-body",children:s("balanceOverview.scoreMeterDescription")})]}),e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("balanceOverview.weeklyBreakdownTitle")}),e.jsx(L,{width:"100%",height:280,children:e.jsxs(U,{data:a,layout:"vertical",margin:u?{top:5,right:10,left:5,bottom:5}:{top:5,right:30,left:80,bottom:5},children:[e.jsx(O,{type:"number",domain:[0,100],hide:!0}),e.jsx(J,{dataKey:"week",type:"category",width:u?50:75,tick:{fontSize:12}}),e.jsx(ie,{formatter:l=>l!==void 0?`${Math.round(l)}%`:"N/A",contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-default)",borderRadius:"8px"}}),e.jsx(T,{dataKey:"positive",stackId:"sentiment",fill:"var(--color-success)",name:s("balanceOverview.chartPositive"),children:a.map((l,m)=>e.jsx(E,{opacity:l.opacity},`positive-${m}`))}),e.jsx(T,{dataKey:"neutral",stackId:"sentiment",fill:"var(--color-neutral)",name:s("balanceOverview.chartNeutral"),children:a.map((l,m)=>e.jsx(E,{opacity:l.opacity},`neutral-${m}`))}),e.jsx(T,{dataKey:"limit",stackId:"sentiment",fill:"var(--color-danger)",name:s("balanceOverview.chartLimit"),children:a.map((l,m)=>e.jsx(E,{opacity:l.opacity},`limit-${m}`))})]})}),e.jsx("p",{className:"text-xs text-body",children:s("balanceOverview.lowDataWarning")})]})]})}const $e=6;function Fe({data:t}){const{t:s}=C("stats"),a=h.useMemo(()=>P(8),[]),o=h.useMemo(()=>Le(t.entries,t,a),[t,a]),n=h.useMemo(()=>Ae(t.entries,t,a),[t,a]),r=h.useMemo(()=>new Set((t.dashboardCards||[]).map(m=>m.categoryId)),[t.dashboardCards]),u=t.dashboardCards?.length??0;if(o.length===0&&n.length===0)return null;function l(m,d){if(!r.has(m)){if(u>=$e){ee(s("focusAreas.dashboardFull"));return}ne(m),ee(s("focusAreas.addedToDashboard",{name:d}))}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-heading",children:s("focusAreas.title")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.length>0&&e.jsx(se,{title:s("focusAreas.limitPanel.title"),subtitle:s("focusAreas.limitPanel.subtitle"),rows:o,accent:"limit",followedIds:r,onFollow:l,followingLabel:s("focusAreas.following"),followLabel:s("focusAreas.follow")}),n.length>0&&e.jsx(se,{title:s("focusAreas.positivePanel.title"),subtitle:s("focusAreas.positivePanel.subtitle"),rows:n,accent:"positive",followedIds:r,onFollow:l,followingLabel:s("focusAreas.following"),followLabel:s("focusAreas.follow")})]})]})}function se({title:t,subtitle:s,rows:a,accent:o,followedIds:n,onFollow:r,followingLabel:u,followLabel:l}){const m=Q(),d=o==="limit"?"var(--color-danger)":"var(--color-food)",i=Math.max(...a.map(c=>c.value),1);return e.jsxs("div",{className:"card p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-heading",children:t}),e.jsx("p",{className:"text-xs text-label mt-0.5",children:s})]}),e.jsx("div",{className:"space-y-2",children:a.map(c=>{const x=n.has(c.categoryId),g=Math.max(c.value/i*100,4);return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-heading truncate",children:c.categoryName}),e.jsx("span",{className:"text-xs text-label whitespace-nowrap",children:c.label})]}),e.jsx("button",{onClick:()=>r(c.categoryId,c.categoryName),disabled:x,className:_("text-xs font-medium px-2 py-0.5 rounded transition-colors whitespace-nowrap",x?"text-label cursor-default":"text-body hover:bg-[var(--bg-inset)]",!m&&!x&&"sm:opacity-0 sm:group-hover:opacity-100"),children:x?u:l})]}),e.jsx("div",{className:"h-2 rounded-full bg-[var(--bg-inset)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300",style:{width:`${g}%`,backgroundColor:d,opacity:.7}})})]},c.categoryId)})})]})}function Oe({weeklyData:t}){const[s,a]=h.useState({isOpen:!1,week:null}),o=h.useMemo(()=>De(t,9),[t]),n=h.useMemo(()=>Ie(o),[o]),r=h.useMemo(()=>t.map(i=>{const c=Te(i,o),x=c.reduce((f,v)=>f+v.count,0),g={week:F(i.start),weekKey:i.weekKey,opacity:i.hasLowData?.4:1};return c.forEach(f=>{g[f.categoryId]=x>0?f.count/x*100:0}),g}),[t,o]),u=h.useMemo(()=>[...o,"OTHER"],[o]),l=h.useMemo(()=>{const i=new Map;return t.forEach(c=>{c.categories.forEach(x=>{i.has(x.categoryId)||i.set(x.categoryId,x.categoryName)})}),i.set("OTHER","Other"),i},[t]),m=Q(),d=i=>{const c=t.find(x=>x.weekKey===i.weekKey);c&&a({isOpen:!0,week:c})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Category Composition"}),e.jsx(L,{width:"100%",height:280,children:e.jsxs(U,{data:r,layout:"vertical",margin:m?{top:5,right:10,left:5,bottom:5}:{top:5,right:30,left:80,bottom:5},onClick:i=>{i.isTooltipActive&&typeof i.activeTooltipIndex=="number"&&d(r[i.activeTooltipIndex])},children:[e.jsx(O,{type:"number",domain:[0,100],hide:!0}),e.jsx(J,{dataKey:"week",type:"category",width:m?50:75,tick:{fontSize:12}}),e.jsx(ie,{formatter:i=>i!==void 0?`${Math.round(i)}%`:"N/A",contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-default)",borderRadius:"8px"},cursor:{fill:"var(--bg-inset)"}}),u.map(i=>e.jsx(T,{dataKey:i,stackId:"categories",fill:n.get(i)||"var(--color-neutral)",name:l.get(i)||i,isAnimationActive:!1,children:r.map((c,x)=>e.jsx(E,{opacity:c.opacity,cursor:"pointer"},`${i}-${x}`))},i))]})}),e.jsx("p",{className:"text-xs text-body",children:"Click a bar to see detailed category breakdown"})]}),s.isOpen&&s.week&&e.jsx(Pe,{week:s.week,colorMap:n,onClose:()=>a({isOpen:!1,week:null})})]})}function Pe({week:t,colorMap:s,onClose:a}){const o=h.useMemo(()=>[...t.categories].sort((n,r)=>r.count-n.count),[t.categories]);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-end z-50 sm:items-center",children:[e.jsxs("div",{className:"bg-[var(--bg-elevated)] w-full sm:w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl p-6 space-y-4 max-h-96 overflow-y-auto",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b border-[var(--border-default)]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-heading",children:["Week of ",F(t.start)]}),e.jsxs("p",{className:"text-sm text-body",children:[t.totalCount," events"]})]}),e.jsx("button",{onClick:a,className:"text-label hover:text-heading text-xl",children:"✕"})]}),e.jsx("div",{className:"space-y-3",children:o.map(n=>{const r=t.totalCount>0?Math.round(n.count/t.totalCount*100):0,u=s.get(n.categoryId);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:u}}),e.jsx("span",{className:"font-medium truncate text-heading",children:n.categoryName})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-sm text-body",children:[r,"%"]}),e.jsxs("span",{className:"text-sm font-semibold text-heading",children:["(",n.count,")"]})]})]}),e.jsx("div",{className:"bg-[var(--bg-inset)] rounded h-1.5",children:e.jsx("div",{className:"h-full rounded transition-all",style:{width:`${r}%`,backgroundColor:u}})})]},n.categoryId)})})]}),e.jsx("div",{className:"fixed inset-0 -z-10",onClick:a})]})}const Re={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Be({categoryName:t,sentiment:s,sparklineData:a,currentCount:o,baselineAvg:n,deltaPercent:r,daysElapsed:u,onRemove:l,onCardClick:m}){const{t:d}=C("stats"),i=Re[s],c=Math.abs(r)<.1,x=Math.round(Math.abs(r)*100),g=h.useMemo(()=>c?d("goalCard.noMeaningfulChange"):`${r>0?"+":"−"}${x}%`,[c,r,x,d]),f=n*(u/7),v=h.useMemo(()=>{if(c)return null;const p=o-f,w=p>=0?"+":"−",N=Math.abs(p),k=Number.isInteger(N)?N.toString():N.toFixed(1),D=d("goalCard.event",{count:Math.round(N)});return`(${w}${k} ${D})`},[c,o,f,d]),b=Number.isInteger(n)?n.toString():n.toFixed(1);return e.jsxs("div",{className:"card p-4 flex flex-col justify-between relative group h-full min-h-[160px] cursor-pointer active:scale-[0.98] transition-transform",onClick:m,role:"button",tabIndex:0,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),m?.())},children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),l()},className:"absolute top-2 right-2 p-1 text-label opacity-60 sm:opacity-0 group-hover:opacity-100 transition-opacity hover:text-[var(--color-danger)]",title:d("goalCard.removeFromDashboard"),children:e.jsx(Y,{className:"w-4 h-4",strokeWidth:2})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i}}),e.jsx("span",{className:"text-xs font-medium text-label truncate max-w-[120px]",children:t})]}),e.jsxs("div",{className:"mt-1.5 space-y-0",children:[e.jsxs("div",{className:"text-sm font-semibold text-heading",children:[d("goalCard.thisWeek",{count:o}),u<7&&e.jsxs("span",{className:"text-xs font-normal text-label",children:[" ",d("goalCard.partialWeek",{day:u})]})]}),e.jsx("div",{className:"text-xs text-label",children:d("goalCard.baselineAvg",{count:Math.round(n),avg:b})})]}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-lg font-bold",style:{color:c?void 0:i},children:g}),v&&e.jsx("span",{className:"text-[10px] text-label",children:v}),!c&&u<7&&e.jsx("span",{className:"text-[10px] text-label",children:d("goalCard.vsPace")})]}),e.jsx("div",{className:"h-12 w-full -mx-2 mt-1",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(le,{data:a,children:[e.jsx(ce,{y:n,stroke:"var(--border-default)",strokeDasharray:"3 3",strokeWidth:1}),e.jsx(de,{type:"monotone",dataKey:"count",stroke:i,strokeWidth:2,dot:p=>{const{cx:w,cy:N,index:k}=p;return w==null||N==null||k==null?e.jsx(e.Fragment,{}):k===a.length-1?e.jsx(z,{cx:w,cy:N,r:4,fill:i,stroke:"var(--bg-card)",strokeWidth:2}):e.jsx(z,{cx:w,cy:N,r:2,fill:i,stroke:"none",opacity:.35})},isAnimationActive:!1})]})})})]})}function Ke({onClose:t}){const{t:s}=C("stats"),a=fe(),o=pe(),n=ye(),[r,u]=h.useState(""),l=h.useMemo(()=>new Set(a.map(c=>c.categoryId)),[a]),m=h.useMemo(()=>[...o.map(x=>({...x,type:"food"})),...n.map(x=>({...x,type:"activity"}))].sort((x,g)=>x.name.localeCompare(g.name)),[o,n]),d=h.useMemo(()=>{const c=r.toLowerCase().trim();return m.filter(x=>x.name.toLowerCase().includes(c))},[m,r]),i=c=>{l.has(c)||(ne(c),t())};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"card w-full max-w-md bg-elevated shadow-elevated flex flex-col max-h-[80vh]",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:s("addCategoryModal.title")}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-inset rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5",strokeWidth:2})})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:s("addCategoryModal.searchPlaceholder"),className:"form-input",value:r,onChange:c=>u(c.target.value),autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[d.map(c=>{const x=l.has(c.id);return e.jsxs("button",{onClick:()=>i(c.id),disabled:x,className:`w-full text-left px-3 py-2 rounded-md flex items-center justify-between transition-colors ${x?"opacity-50 cursor-not-allowed bg-inset":"hover:bg-inset"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:c.type==="food"?"var(--color-food)":"var(--color-activity)"}}),e.jsx("span",{className:"font-medium",children:c.name}),e.jsx("span",{className:"text-xs text-label px-1.5 py-0.5 rounded-full bg-inset capitalize",children:c.type})]}),x&&e.jsx("span",{className:"text-xs font-medium text-label",children:s("addCategoryModal.added")})]},c.id)}),d.length===0&&e.jsx("div",{className:"py-8 text-center text-label",children:s("addCategoryModal.noResults",{search:r})})]})]}),e.jsx("div",{className:"fixed inset-0 -z-10",onClick:t})]})}function ze(){const{t}=C("stats"),s=oe(),a=X(),[o,n]=h.useState(!1),r=h.useMemo(()=>P(8),[a.entries]),u=r[r.length-1],l=u?me(u.start):7,m=h.useMemo(()=>a.dashboardCards?a.dashboardCards.map(d=>{const i=d.categoryId,c=a.foodCategories.find(j=>j.id===i),x=a.activityCategories.find(j=>j.id===i),g=c||x;if(!g)return null;const f=g.name,v=g.sentiment,b=r.map(j=>{const S={start:$(j.start),end:$(j.end)},B=re(G(a.entries,S),i,a);return{week:j.key,count:B.length}}),p=b[b.length-1].count,k=b.slice(3,7).reduce((j,S)=>j+S.count,0)/4,D=k*(l/7),A=p-D,R=D===0?p>0?1:0:A/D;return{categoryId:i,categoryName:f,sentiment:v,sparklineData:b,currentCount:p,baselineAvg:k,deltaPercent:R,daysElapsed:l}}).filter(d=>d!==null):[],[a,r,l]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-heading",children:t("goalDashboard.title")}),e.jsx("button",{onClick:()=>n(!0),className:"text-sm font-medium transition-colors hover:opacity-80",style:{color:"var(--color-activity)"},children:t("goalDashboard.addToDashboard")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 overflow-y-auto pr-1",style:{maxHeight:"calc(3 * 180px + 2 * 1rem)"},children:[m.map(d=>e.jsx(Be,{categoryName:d.categoryName,sentiment:d.sentiment,sparklineData:d.sparklineData,currentCount:d.currentCount,baselineAvg:d.baselineAvg,deltaPercent:d.deltaPercent,daysElapsed:d.daysElapsed,onRemove:()=>ve(d.categoryId),onCardClick:()=>s(`/stats/category/${d.categoryId}`)},d.categoryId)),m.length===0&&e.jsxs("div",{className:"col-span-full py-8 text-center card bg-inset border-dashed",children:[e.jsx("p",{className:"text-label text-sm",children:t("goalDashboard.noDashboardCards")}),e.jsx("button",{onClick:()=>n(!0),className:"mt-2 text-sm font-semibold",style:{color:"var(--color-activity)"},children:t("goalDashboard.addFirstCategory")})]})]}),o&&e.jsx(Ke,{onClose:()=>n(!1)})]})}function qe(t,s){const a=new Map([...s.activityItems,...s.foodItems].map(n=>[n.id,n])),o=new Map;for(const n of t){const r=o.get(n.itemId);if(r)r.count++;else{const u=a.get(n.itemId);o.set(n.itemId,{id:n.itemId,name:u?.name??"Unknown",count:1,type:n.type})}}return Array.from(o.values()).sort((n,r)=>r.count-n.count)}function He(t,s){const a=new Map([...s.activityCategories,...s.foodCategories].map(n=>[n.id,n])),o=new Map;for(const n of t){const r=V(n,s);for(const u of r){const l=o.get(u);if(l)l.count++;else{const m=a.get(u);o.set(u,{id:u,name:m?.name??"Unknown",count:1,type:n.type})}}}return Array.from(o.values()).sort((n,r)=>r.count-n.count)}function Ve({entries:t,data:s}){const{t:a}=C("stats"),[o,n]=h.useState("all"),[r,u]=h.useState("all"),[l,m]=h.useState("items"),d=h.useMemo(()=>o==="all"?t:G(t,{start:je((o==="7d"?7:30)-1),end:be()}),[t,o]),i=h.useMemo(()=>r==="all"?d:H(d,r),[d,r]),c=h.useMemo(()=>l==="items"?qe(i,s):He(i,s),[i,s,l]),x=c.length>0?c[0].count:0;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-heading",children:a("frequencyRanking.title")}),e.jsx(W,{options:[{value:"all",label:a("frequencyRanking.timePeriod.all")},{value:"7d",label:a("frequencyRanking.timePeriod.7d")},{value:"30d",label:a("frequencyRanking.timePeriod.30d")}],value:o,onChange:n,variant:"segment",size:"sm"}),e.jsx(W,{options:[{value:"all",label:a("frequencyRanking.typeFilter.all"),activeClass:"bg-[var(--text-secondary)] text-white"},{value:"activity",label:a("frequencyRanking.typeFilter.activities"),activeClass:"type-activity"},{value:"food",label:a("frequencyRanking.typeFilter.food"),activeClass:"type-food"}],value:r,onChange:u,variant:"segment",size:"sm"}),e.jsx(W,{options:[{value:"items",label:a("frequencyRanking.viewMode.items")},{value:"categories",label:a("frequencyRanking.viewMode.categories")}],value:l,onChange:m,variant:"segment",size:"sm"}),c.length===0?e.jsx("p",{className:"text-sm text-label text-center py-4",children:a("frequencyRanking.empty",{viewMode:a(`frequencyRanking.viewMode.${l}`).toLowerCase()})}):e.jsx("div",{className:"space-y-1.5",children:c.map((g,f)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted w-5 text-right shrink-0",children:f+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsx("span",{className:"text-sm text-heading truncate",children:g.name}),e.jsx("span",{className:"text-xs text-label shrink-0",children:g.count})]}),e.jsx("div",{className:"h-1 rounded-full bg-[var(--bg-inset)] overflow-hidden",children:e.jsx("div",{className:_("h-full rounded-full transition-all",g.type==="activity"?"bg-[var(--color-activity)]":"bg-[var(--color-food)]"),style:{width:`${g.count/x*100}%`}})})]})]},g.id))})]})}function at(){const{t}=C("stats"),s=X(),[a,o]=h.useState("weekly"),n=h.useMemo(()=>P(8),[]),r=h.useMemo(()=>ke(s.entries,s,n),[s,n]),u=h.useMemo(()=>r.some(l=>l.totalCount>0),[r]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("title")}),e.jsx("p",{className:"text-body",children:t("subtitle")})]}),e.jsx(W,{options:[{value:"weekly",label:t("period.weekly")},{value:"monthly",label:t("period.monthly"),disabled:!0,title:t("period.monthlyComingSoon")}],value:a,onChange:o,variant:"segment",size:"sm"}),!u&&e.jsxs("div",{className:"card p-8 text-center space-y-2",children:[e.jsx("p",{className:"text-body",children:t("empty.noFoodEntries")}),e.jsx("p",{className:"text-sm text-label",children:t("empty.startLogging")})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{}),e.jsx("hr",{className:"border-[var(--border-default)]"}),e.jsx(We,{weeklyData:r}),e.jsx(Fe,{data:s}),e.jsx(Oe,{weeklyData:r})]}),s.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-[var(--border-default)]"}),e.jsx(Ve,{entries:s.entries,data:s})]})]})}const _e={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Ye({weekNumber:t,total:s,dailyData:a,sentiment:o}){const{t:n}=C("stats"),r=_e[o],u=Math.max(...a.map(l=>l.count),1);return e.jsxs("div",{className:"card p-3 space-y-2 shadow-[var(--shadow-elevated)]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{className:"text-sm font-semibold text-heading",children:n("categoryDetail.weekBreakdownTitle",{week:t})}),e.jsx("span",{className:"text-xs text-label",children:n("categoryDetail.weekBreakdownTotal",{count:s})})]}),e.jsx("div",{className:"h-20",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(U,{data:a,margin:{top:4,right:0,left:0,bottom:0},children:[e.jsx(O,{dataKey:"day",tickLine:!1,axisLine:!1,tick:{fontSize:11,fill:"var(--text-tertiary)"}}),e.jsx(T,{dataKey:"count",radius:[3,3,0,0],isAnimationActive:!1,children:a.map((l,m)=>e.jsx(E,{fill:l.count>0?r:"var(--bg-inset)",opacity:l.count>0?.4+l.count/u*.6:.3},m))})]})})})]})}const Xe={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Ge({weeks:t,baselineAvg:s,sentiment:a,selectedWeekIndex:o,onSelectWeek:n}){const r=Xe[a],u=h.useMemo(()=>t.map(d=>({label:F(d.start),count:d.count})),[t]),l=h.useMemo(()=>Math.max(...t.map(d=>d.count),s,1),[t,s]),m=h.useMemo(()=>{if(o===null||!t[o])return null;const d=t[o];return{weekNumber:ge(d.weekKey),total:d.count,dailyData:Ee(d.entries,d.start,d.end)}},[o,t]);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-48 w-full -mx-2",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(le,{data:u,margin:{top:24,right:16,left:8,bottom:4},onClick:d=>{const i=typeof d?.activeTooltipIndex=="number"?d.activeTooltipIndex:null;i!==null&&n(i===o?null:i)},children:[e.jsx(O,{dataKey:"label",tickLine:!1,axisLine:!1,tick:{fontSize:11,fill:"var(--text-tertiary)"}}),e.jsx(J,{hide:!0,domain:[0,Math.ceil(l*1.2)]}),e.jsx(ce,{y:s,stroke:"var(--border-default)",strokeDasharray:"4 4",strokeWidth:1}),e.jsx(de,{type:"monotone",dataKey:"count",stroke:r,strokeWidth:2.5,isAnimationActive:!1,dot:d=>{const{cx:i,cy:c,index:x,payload:g}=d;if(i==null||c==null||x==null)return e.jsx("g",{});const f=x===o,v=x===t.length-1,b=f||v?5:3;return e.jsxs("g",{children:[e.jsx(z,{cx:i,cy:c,r:b,fill:f||v?r:"var(--bg-card)",stroke:r,strokeWidth:2}),e.jsx("text",{x:i,y:c-12,textAnchor:"middle",fontSize:11,fontWeight:600,fill:"var(--text-secondary)",children:g?.count})]})},activeDot:!1})]})})}),m&&e.jsx(Ye,{weekNumber:m.weekNumber,total:m.total,dailyData:m.dailyData,sentiment:a})]})}const Ue={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Je({weeks:t,currentWeekIndex:s,selectedWeekIndex:a,sentiment:o,onSelectWeek:n}){const{t:r}=C("stats"),u=Ue[o];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-heading",children:r("categoryDetail.last8Weeks")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.map((l,m)=>{const d=m===s,i=m===a;return e.jsxs("button",{onClick:()=>n(m),className:_("card p-3 flex items-center justify-between text-left transition-all",i&&"ring-1"),style:{borderLeftWidth:d?"3px":void 0,borderLeftColor:d?u:void 0,"--tw-ring-color":i?u:void 0},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-heading",children:r("categoryDetail.weekLabel",{week:l.weekNumber})}),e.jsx("div",{className:"text-lg font-bold text-heading",children:l.count})]}),e.jsx("div",{className:"text-xs font-medium",style:{color:Qe(l.percentChange,o)},children:Ze(l.percentChange)})]},l.weekNumber)})})]})}function Qe(t,s){if(t===null||t===0)return"var(--text-muted)";if(s==="neutral")return"var(--text-secondary)";const a=s==="limit";return t>0?a?"var(--color-danger)":"var(--color-success)":a?"var(--color-success)":"var(--color-danger)"}function Ze(t){return t===null?"--":t===0?"0%":`${t>0?"+":""}${Math.round(t)}%`}const et={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function nt(){const{categoryId:t}=Ne(),s=oe(),{t:a}=C("stats"),o=X(),[n,r]=h.useState(null),u=h.useMemo(()=>P(8),[o.entries]),l=u[u.length-1],m=l?me(l.start):7,d=h.useMemo(()=>o.foodCategories.find(y=>y.id===t)||o.activityCategories.find(y=>y.id===t),[o.foodCategories,o.activityCategories,t]),i=h.useMemo(()=>t?u.map(y=>{const I={start:$(y.start),end:$(y.end)},M=re(G(o.entries,I),t,o);return{weekKey:y.key,label:y.key,count:M.length,start:y.start,end:y.end,entries:M}}):[],[u,t,o]),c=h.useMemo(()=>i.slice(3,7).reduce((M,K)=>M+K.count,0)/4,[i]),x=i.length>0?i[i.length-1].count:0,g=c*(m/7),f=x-g,v=g===0?x>0?1:0:f/g,b=Math.abs(v)<.1,p=d?.sentiment??"neutral",w=et[p],N=h.useMemo(()=>i.map((y,I)=>{const M=I>0?i[I-1].count:null,K=M===null?null:M===0?y.count>0?100:0:(y.count-M)/M*100;return{weekNumber:ge(y.weekKey),count:y.count,percentChange:K}}),[i]);if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-4",children:[e.jsx("p",{className:"text-label",children:a("categoryDetail.notFound")}),e.jsx("button",{onClick:()=>s("/stats"),className:"btn btn-secondary btn-sm",children:a("categoryDetail.goBack")})]});const k=Number.isInteger(c)?c.toString():c.toFixed(1),D=Math.round(Math.abs(v)*100),A=v>0?"+":"−",R=b?"":`${A}${D}%`,j=Math.abs(f),S=Number.isInteger(j)?j.toString():j.toFixed(1),B=a("categoryDetail.event",{count:Math.round(j)}),Z=b?null:`(${A}${S} ${B})`;return e.jsxs("div",{className:"space-y-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:w}}),e.jsx("h1",{className:"text-xl font-bold text-heading",children:d.name})]}),e.jsx("button",{onClick:()=>s("/stats"),className:"p-2 -mr-2 text-label hover:text-heading transition-colors",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"card p-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-heading",children:a("categoryDetail.thisWeek",{count:x})}),e.jsx("div",{className:"text-xs text-label",children:a("categoryDetail.baselineAvg",{avg:k})}),!b&&e.jsxs("div",{className:"flex items-baseline gap-1.5 pt-1",children:[e.jsx("span",{className:"text-lg font-bold",style:{color:w},children:R}),Z&&e.jsx("span",{className:"text-xs text-label",children:Z})]})]}),e.jsx(Ge,{weeks:i,baselineAvg:c,sentiment:p,selectedWeekIndex:n,onSelectWeek:r}),e.jsx(Je,{weeks:N,currentWeekIndex:i.length-1,selectedWeekIndex:n,sentiment:p,onSelectWeek:r})]})}export{Fe as ActionableCategories,Ke as AddCategoryModal,We as BalanceOverview,Oe as CategoryComposition,nt as CategoryDetailPage,Ve as FrequencyRanking,Be as GoalCard,ze as GoalDashboard,at as StatsPage};
