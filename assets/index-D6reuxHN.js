import{u as v,w as B,j as e,S as w,x as F,y as R,z as C,A as b,B as y,C as T,D as G,E as I,F as S,G as L,H as M,I as E,J as P}from"./index-BOcMPlv2.js";import{b as l}from"./recharts-DVTnlDRN.js";function q(){const{t:a}=v("settings"),[r,t]=l.useState(B());function s(o){t(o),F(o),R(o)}return e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-heading",children:a("appearance.title")}),e.jsx("p",{className:"text-sm text-body",children:a("appearance.description")}),e.jsx(w,{options:[{value:"light",label:a("appearance.theme.light")},{value:"dark",label:a("appearance.theme.dark")},{value:"system",label:a("appearance.theme.system")}],value:r,onChange:s,variant:"segment"})]})}function D({onBrowseGists:a,selectedGistId:r}){const{t}=v("settings"),[s,o]=l.useState(C().token),[p,m]=l.useState(C().gistId||""),[n,d]=l.useState("idle"),[i,c]=l.useState("");l.useEffect(()=>{r&&(m(r),b({gistId:r}),c(t("gistConfig.messages.gistSelected")),y())},[r,t]);async function x(){if(!s.trim()){c(t("gistConfig.messages.enterToken")),d("invalid");return}d("validating"),c(""),await T(s.trim())?(d("valid"),c(t("gistConfig.messages.tokenValid")),b({token:s.trim(),gistId:p||null})):(d("invalid"),c(t("gistConfig.messages.tokenInvalid")))}async function h(){if(!s.trim()){c(t("gistConfig.messages.tokenRequired"));return}d("loading");try{const g=await G(s.trim());a(g,"primary"),d("idle")}catch{c(t("gistConfig.messages.loadGistsFailed")),d("invalid")}}async function k(){if(!s.trim()){c(t("gistConfig.messages.tokenRequired"));return}d("loading");try{const g=await I(s.trim());m(g),b({token:s.trim(),gistId:g}),c(t("gistConfig.messages.gistCreated")),d("valid")}catch{c(t("gistConfig.messages.gistCreateFailed")),d("invalid")}}function j(){if(!p.trim()){c(t("gistConfig.messages.gistIdRequired"));return}b({token:s.trim(),gistId:p.trim()}),c(t("gistConfig.messages.settingsSaved")),y()}return e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-heading",children:t("gistConfig.title")}),e.jsxs("p",{className:"text-sm text-body",children:[t("gistConfig.description")," ",e.jsx("code",{className:"bg-[var(--bg-inset)] px-1 rounded text-heading",children:"gist"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"token",className:"form-label",children:t("gistConfig.tokenLabel")}),e.jsx("input",{id:"token",type:"password",value:s,onChange:g=>o(g.target.value),placeholder:t("gistConfig.tokenPlaceholder"),className:"form-input"}),e.jsx("button",{onClick:x,disabled:n==="validating",className:"w-full btn-primary",children:t(n==="validating"?"gistConfig.validatingButton":"gistConfig.validateButton")})]}),(n==="valid"||p)&&e.jsxs("div",{className:"border-t border-[var(--border-default)] pt-4 space-y-2",children:[e.jsx("label",{htmlFor:"gistId",className:"form-label",children:t("gistConfig.gistIdLabel")}),e.jsx("input",{id:"gistId",type:"text",value:p,onChange:g=>m(g.target.value),placeholder:t("gistConfig.gistIdPlaceholder"),className:"form-input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,className:"flex-1 btn-success",children:t("gistConfig.saveLoadButton")}),e.jsx("button",{onClick:h,className:"flex-1 btn-secondary",children:t("gistConfig.browseGistsButton")}),e.jsx("button",{onClick:k,className:"flex-1 btn-primary",children:t("gistConfig.createNewButton")})]})]}),i&&e.jsx("p",{className:"text-sm",style:{color:`var(${n==="invalid"?"--color-danger":"--color-success"})`},children:i})]})}function V({onMessage:a}){const{t:r}=v("settings"),t=l.useRef(null),[s,o]=l.useState(null);function p(){L()}function m(){t.current?.click()}function n(i){const c=i.target.files?.[0];c&&(o(c),i.target.value="")}function d(){if(!s)return;const i=new FileReader;i.onload=c=>{const x=c.target?.result;M(x)?a(r("exportImport.importSuccess"),!1):a(r("exportImport.importFailed"),!0),o(null)},i.readAsText(s)}return e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-heading",children:r("exportImport.title")}),e.jsx("p",{className:"text-sm text-body",children:r("exportImport.description")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"flex-1 btn-primary",children:r("exportImport.exportButton")}),e.jsx("button",{onClick:m,className:"flex-1 btn-secondary",children:r("exportImport.importButton")})]}),e.jsx("input",{type:"file",accept:".json,application/json",className:"hidden",ref:t,onChange:n}),e.jsx(S,{open:s!==null,onClose:()=>o(null),onConfirm:d,title:r("exportImport.confirmTitle"),message:r("exportImport.confirmMessage"),confirmLabel:r("exportImport.confirmLabel")})]})}function $({token:a,onBrowseGists:r,selectedGistId:t}){const{t:s}=v("settings"),[o,p]=l.useState(C().backupGistId||""),[m,n]=l.useState("idle"),[d,i]=l.useState(""),[c,x]=l.useState(!1);l.useEffect(()=>{t&&(p(t),b({backupGistId:t}),i(s("backup.messages.backupGistSelected")),n("success"))},[t,s]);async function h(){if(!a.trim()){i(s("backup.messages.tokenRequired")),n("error");return}try{const f=await G(a.trim());r(f,"backup")}catch{i(s("backup.messages.loadGistsFailed")),n("error")}}async function k(){if(!o.trim()){i(s("backup.messages.backupGistRequired")),n("error");return}n("backing-up"),i("");try{await E(o.trim()),i(s("backup.messages.backupComplete")),n("success")}catch{i(s("backup.messages.backupFailed")),n("error")}}function j(){if(!o.trim()){i(s("backup.messages.backupGistRequired")),n("error");return}x(!0)}async function g(){n("restoring"),i("");try{await P(o.trim()),i(s("backup.messages.restoreComplete")),n("success")}catch{i(s("backup.messages.restoreFailed")),n("error")}}async function N(){if(!a.trim()){i(s("backup.messages.tokenRequired")),n("error");return}n("backing-up");try{const f=await I(a.trim());p(f),b({backupGistId:f}),i(s("backup.messages.backupGistCreated")),n("success")}catch{i(s("backup.messages.createBackupFailed")),n("error")}}function u(){b({backupGistId:o.trim()||null}),i(s("backup.messages.backupGistIdSaved")),n("success")}return e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-heading",children:s("backup.title")}),e.jsx("p",{className:"text-sm text-body",children:s("backup.description")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"backupGistId",className:"form-label",children:s("backup.gistIdLabel")}),e.jsx("input",{id:"backupGistId",type:"text",value:o,onChange:f=>p(f.target.value),placeholder:s("backup.gistIdPlaceholder"),className:"form-input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"flex-1 btn-secondary",children:s("backup.saveButton")}),e.jsx("button",{onClick:h,className:"flex-1 btn-secondary",children:s("backup.browseButton")}),e.jsx("button",{onClick:N,className:"flex-1 btn-primary",children:s("backup.createNewButton")})]})]}),o&&e.jsx("div",{className:"border-t border-[var(--border-default)] pt-4 space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,disabled:m==="backing-up"||m==="restoring",className:"flex-1 btn-success",children:s(m==="backing-up"?"backup.backingUpButton":"backup.backupNowButton")}),e.jsx("button",{onClick:j,disabled:m==="backing-up"||m==="restoring",className:"flex-1 btn-danger",children:s(m==="restoring"?"backup.restoringButton":"backup.restoreButton")})]})}),d&&e.jsx("p",{className:"text-sm",style:{color:`var(${m==="error"?"--color-danger":"--color-success"})`},children:d}),e.jsx(S,{open:c,onClose:()=>x(!1),onConfirm:g,title:s("backup.confirmTitle"),message:s("backup.confirmMessage"),confirmLabel:s("backup.confirmLabel")})]})}function U(){const{t:a}=v("settings"),[r,t]=l.useState([]),[s,o]=l.useState(!1),[p,m]=l.useState("primary"),[n,d]=l.useState(null),[i,c]=l.useState(null),[x,h]=l.useState(null),k=C().token;function j(u,f){t(u),m(f),o(!0)}function g(u){p==="primary"?d(u):c(u),o(!1)}function N(u,f){h({text:u,isError:f})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-heading",children:a("title")}),e.jsx(q,{}),e.jsx(D,{onBrowseGists:j,selectedGistId:n}),s&&r.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h4",{className:"text-sm font-medium text-body mb-2",children:a(p==="primary"?"gistList.yourGists":"gistList.selectBackup")}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:r.map(u=>e.jsxs("button",{onClick:()=>g(u.id),className:`w-full text-left p-3 border rounded-md hover:bg-[var(--bg-card-hover)] transition-colors ${u.files.includes("tracker-data.json")?"border-[var(--color-success-border)] bg-[var(--color-success-bg)]":"border-[var(--border-default)]"}`,children:[e.jsx("div",{className:"text-sm font-medium truncate text-heading",children:u.description}),e.jsx("div",{className:"text-xs text-label",children:u.id}),e.jsxs("div",{className:"text-xs text-subtle",children:["Files: ",u.files.slice(0,3).join(", "),u.files.length>3?"...":""]}),u.files.includes("tracker-data.json")&&e.jsx("span",{className:"text-xs",style:{color:"var(--color-success)"},children:a("gistList.containsTrackerData")})]},u.id))})]}),e.jsx(V,{onMessage:N}),x&&e.jsx("p",{className:"text-sm px-6",style:{color:`var(${x.isError?"--color-danger":"--color-success"})`},children:x.text}),k&&e.jsx($,{token:k,onBrowseGists:j,selectedGistId:i}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-heading mb-4",children:a("tokenGuide.title")}),e.jsxs("ol",{className:"text-sm text-body space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:a("tokenGuide.step1")}),e.jsx("li",{children:a("tokenGuide.step2")}),e.jsx("li",{children:a("tokenGuide.step3")}),e.jsx("li",{children:a("tokenGuide.step4")}),e.jsx("li",{children:a("tokenGuide.step5")})]})]})]})}export{U as SettingsPage};
