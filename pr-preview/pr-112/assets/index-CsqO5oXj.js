import{g as S,f as E,a as q,b as A,u as C,c as T,j as e,s as L,d as z,e as K,X as V,h as ae,i as ne,k as oe,l as H,m as O,n as re,o as Y,r as ie,p as le,q as ce,S as k}from"./index-DSvvRbH0.js";import{b as g,e as P,B as X,X as _,Y as G,T as U,f as M,C as I,L as de,h as ue,i as me,D as W}from"./recharts-DVTnlDRN.js";function J(s){const t=new Date(s);t.setHours(0,0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));const n=new Date(t.getFullYear(),0,1),o=Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7);return{year:t.getFullYear(),week:o}}function he(s,t){const n=new Date(s,0,1+(t-1)*7),o=n.getDay(),a=n;return o<=4?a.setDate(n.getDate()-n.getDay()+1):a.setDate(n.getDate()+8-n.getDay()),a}function ge(s){const{year:t,week:n}=J(s);return`${t}-W${String(n).padStart(2,"0")}`}function F(s=8){const t=[],n=new Date;for(let o=s-1;o>=0;o--){const a=new Date(n);a.setDate(a.getDate()-o*7);const i=ge(a),u=he(a.getFullYear(),J(a).week),d=new Date(u);d.setDate(d.getDate()+6),t.find(r=>r.key===i)||t.push({key:i,start:u,end:d})}return t}function xe(s,t){const n=new Date;n.setHours(0,0,0,0);const o=new Date(s);o.setHours(0,0,0,0);const a=n.getTime()-o.getTime(),i=Math.floor(a/864e5)+1;return Math.max(1,Math.min(7,i))}function Q(s,t,n){const o=new Date(s.date+"T00:00:00");return o>=t&&o<=n}function fe(s,t,n){const o=E(s,"food"),a=q(t,"food");return n.map(i=>{const u=o.filter(l=>Q(l,i.start,i.end)),d=new Map;u.forEach(l=>{A(l,t).forEach(m=>{const x=S(m,t),y=a.find(j=>j.id===m)?.sentiment??"neutral";d.has(m)||d.set(m,{categoryId:m,categoryName:x,sentiment:y,count:0});const p=d.get(m);p.count+=1})});const r=Array.from(d.values()),h={positive:r.filter(l=>l.sentiment==="positive").reduce((l,c)=>l+c.count,0),neutral:r.filter(l=>l.sentiment==="neutral").reduce((l,c)=>l+c.count,0),limit:r.filter(l=>l.sentiment==="limit").reduce((l,c)=>l+c.count,0)};return{weekKey:i.key,start:i.start,end:i.end,entries:u,totalCount:u.length,categories:r,sentimentCounts:h,hasLowData:u.length<5}})}function $(s){const{positive:t,limit:n}=s.sentimentCounts;return t+n===0?0:t/(t+n)*100}function pe(s,t){if(t===0)return{direction:"stable",percentChange:0};const n=(s-t)/t*100;return Math.abs(n)<1?{direction:"stable",percentChange:0}:{direction:n>0?"up":"down",percentChange:Math.round(Math.abs(n))}}function ye(s,t=9){const n=new Map;return s.forEach(o=>{o.categories.forEach(a=>{n.set(a.categoryId,(n.get(a.categoryId)||0)+a.count)})}),Array.from(n.entries()).sort((o,a)=>a[1]-o[1]).slice(0,t).map(([o])=>o)}function ve(){if(typeof document>"u")return["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#f97316","#6366f1"];const s=getComputedStyle(document.documentElement);return[s.getPropertyValue("--chart-color-1").trim(),s.getPropertyValue("--chart-color-2").trim(),s.getPropertyValue("--chart-color-3").trim(),s.getPropertyValue("--chart-color-4").trim(),s.getPropertyValue("--chart-color-5").trim(),s.getPropertyValue("--chart-color-6").trim(),s.getPropertyValue("--chart-color-7").trim(),s.getPropertyValue("--chart-color-8").trim(),s.getPropertyValue("--chart-color-9").trim()]}function be(s){const t=ve(),n=new Map;return s.forEach((o,a)=>{n.set(o,t[a%t.length])}),n.set("OTHER","var(--color-neutral)"),n}function je(s,t){const n=[];let o=0;return s.categories.forEach(a=>{t.includes(a.categoryId)?n.push(a):o+=a.count}),o>0&&n.push({categoryId:"OTHER",categoryName:"Other",sentiment:"neutral",count:o}),n.sort((a,i)=>{const u=t.indexOf(a.categoryId),d=t.indexOf(i.categoryId);return u===-1?1:d===-1?-1:u-d})}function Z(s,t,n,o){const a=q(t,"food"),i=new Set(a.filter(m=>m.sentiment===o).map(m=>m.id)),u=new Map;let d=0;if(i.size===0)return{counts:u,total:d,catIds:i};const r=n.slice(-4),h=r[0].start,l=r[r.length-1].end,c=E(s,"food").filter(m=>Q(m,h,l));for(const m of c){const x=A(m,t);for(const f of x)i.has(f)&&(u.set(f,(u.get(f)||0)+1),d++)}return{counts:u,total:d,catIds:i}}function Ne(s,t,n,o=5){const{counts:a,total:i}=Z(s,t,n,"limit");return i===0?[]:Array.from(a.entries()).sort((u,d)=>d[1]-u[1]).slice(0,o).map(([u,d])=>{const r=Math.round(d/i*100),h=S(u,t);return{categoryId:u,categoryName:h,value:r,label:`${r}% of limit total`,count:d}})}function Ce(s,t,n,o=5){const{counts:a,total:i,catIds:u}=Z(s,t,n,"positive");if(i===0)return[];for(const r of u)a.has(r)||a.set(r,0);const d=1/u.size;return Array.from(a.entries()).map(([r,h])=>{const l=h/i,c=d-l;return{catId:r,count:h,share:l,gap:c}}).filter(r=>r.gap>0).sort((r,h)=>h.gap-r.gap).slice(0,o).map(r=>{const h=S(r.catId,t),l=Math.round(r.gap*100);return{categoryId:r.catId,categoryName:h,value:l,label:"Below your positive average"}})}function R(s=640){const t=g.useCallback(o=>{const a=window.matchMedia(`(max-width: ${s-1}px)`);return a.addEventListener("change",o),()=>a.removeEventListener("change",o)},[s]),n=g.useCallback(()=>window.matchMedia(`(max-width: ${s-1}px)`).matches,[s]);return g.useSyncExternalStore(t,n,()=>!1)}function we({weeklyData:s}){const{t}=C("stats"),n=g.useMemo(()=>s.map(d=>{const{positive:r,neutral:h,limit:l}=d.sentimentCounts,c=r+h+l;return{week:T(d.start),positive:c>0?r/c*100:0,neutral:c>0?h/c*100:0,limit:c>0?l/c*100:0,opacity:d.hasLowData?.4:1}}),[s]),o=g.useMemo(()=>s.length===0?0:$(s[s.length-1]),[s]),a=g.useMemo(()=>s.length<2?o:$(s[s.length-2]),[s,o]),i=g.useMemo(()=>pe(o,a),[o,a]),u=R();return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t("balanceOverview.scoreTitle")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-4xl font-bold",style:{color:"var(--color-activity)"},children:[Math.round(o),"%"]}),i.direction!=="stable"&&e.jsxs("div",{className:"text-sm font-semibold flex items-center gap-1",style:{color:i.direction==="up"?"var(--color-success)":"var(--color-danger)"},children:[e.jsx("span",{children:i.direction==="up"?"↑":"↓"}),e.jsxs("span",{children:[i.percentChange,"%"]})]})]})]}),e.jsx("div",{className:"bg-[var(--bg-inset)] rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${o}%`,background:"linear-gradient(to right, var(--color-danger), var(--color-warning), var(--color-success))"}})}),e.jsx("p",{className:"text-xs text-body",children:t("balanceOverview.scoreMeterDescription")})]}),e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t("balanceOverview.weeklyBreakdownTitle")}),e.jsx(P,{width:"100%",height:280,children:e.jsxs(X,{data:n,layout:"vertical",margin:u?{top:5,right:10,left:5,bottom:5}:{top:5,right:30,left:80,bottom:5},children:[e.jsx(_,{type:"number",domain:[0,100],hide:!0}),e.jsx(G,{dataKey:"week",type:"category",width:u?50:75,tick:{fontSize:12}}),e.jsx(U,{formatter:d=>d!==void 0?`${Math.round(d)}%`:"N/A",contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-default)",borderRadius:"8px"}}),e.jsx(M,{dataKey:"positive",stackId:"sentiment",fill:"var(--color-success)",name:t("balanceOverview.chartPositive"),children:n.map((d,r)=>e.jsx(I,{opacity:d.opacity},`positive-${r}`))}),e.jsx(M,{dataKey:"neutral",stackId:"sentiment",fill:"var(--color-neutral)",name:t("balanceOverview.chartNeutral"),children:n.map((d,r)=>e.jsx(I,{opacity:d.opacity},`neutral-${r}`))}),e.jsx(M,{dataKey:"limit",stackId:"sentiment",fill:"var(--color-danger)",name:t("balanceOverview.chartLimit"),children:n.map((d,r)=>e.jsx(I,{opacity:d.opacity},`limit-${r}`))})]})}),e.jsx("p",{className:"text-xs text-body",children:t("balanceOverview.lowDataWarning")})]})]})}const ke=6;function Me({data:s}){const{t}=C("stats"),n=g.useMemo(()=>F(8),[]),o=g.useMemo(()=>Ne(s.entries,s,n),[s,n]),a=g.useMemo(()=>Ce(s.entries,s,n),[s,n]),i=g.useMemo(()=>new Set((s.dashboardCards||[]).map(r=>r.categoryId)),[s.dashboardCards]),u=s.dashboardCards?.length??0;if(o.length===0&&a.length===0)return null;function d(r,h){if(!i.has(r)){if(u>=ke){L(t("focusAreas.dashboardFull"));return}z(r),L(t("focusAreas.addedToDashboard",{name:h}))}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-heading",children:t("focusAreas.title")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.length>0&&e.jsx(B,{title:t("focusAreas.limitPanel.title"),subtitle:t("focusAreas.limitPanel.subtitle"),rows:o,accent:"limit",followedIds:i,onFollow:d,followingLabel:t("focusAreas.following"),followLabel:t("focusAreas.follow")}),a.length>0&&e.jsx(B,{title:t("focusAreas.positivePanel.title"),subtitle:t("focusAreas.positivePanel.subtitle"),rows:a,accent:"positive",followedIds:i,onFollow:d,followingLabel:t("focusAreas.following"),followLabel:t("focusAreas.follow")})]})]})}function B({title:s,subtitle:t,rows:n,accent:o,followedIds:a,onFollow:i,followingLabel:u,followLabel:d}){const r=R(),h=o==="limit"?"var(--color-danger)":"var(--color-food)",l=Math.max(...n.map(c=>c.value),1);return e.jsxs("div",{className:"card p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-heading",children:s}),e.jsx("p",{className:"text-xs text-label mt-0.5",children:t})]}),e.jsx("div",{className:"space-y-2",children:n.map(c=>{const m=a.has(c.categoryId),x=Math.max(c.value/l*100,4);return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-heading truncate",children:c.categoryName}),e.jsx("span",{className:"text-xs text-label whitespace-nowrap",children:c.label})]}),e.jsx("button",{onClick:()=>i(c.categoryId,c.categoryName),disabled:m,className:K("text-xs font-medium px-2 py-0.5 rounded transition-colors whitespace-nowrap",m?"text-label cursor-default":"text-body hover:bg-[var(--bg-inset)]",!r&&!m&&"sm:opacity-0 sm:group-hover:opacity-100"),children:m?u:d})]}),e.jsx("div",{className:"h-2 rounded-full bg-[var(--bg-inset)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300",style:{width:`${x}%`,backgroundColor:h,opacity:.7}})})]},c.categoryId)})})]})}function Ie({weeklyData:s}){const[t,n]=g.useState({isOpen:!1,week:null}),o=g.useMemo(()=>ye(s,9),[s]),a=g.useMemo(()=>be(o),[o]),i=g.useMemo(()=>s.map(l=>{const c=je(l,o),m=c.reduce((f,y)=>f+y.count,0),x={week:T(l.start),weekKey:l.weekKey,opacity:l.hasLowData?.4:1};return c.forEach(f=>{x[f.categoryId]=m>0?f.count/m*100:0}),x}),[s,o]),u=g.useMemo(()=>[...o,"OTHER"],[o]),d=g.useMemo(()=>{const l=new Map;return s.forEach(c=>{c.categories.forEach(m=>{l.has(m.categoryId)||l.set(m.categoryId,m.categoryName)})}),l.set("OTHER","Other"),l},[s]),r=R(),h=l=>{const c=s.find(m=>m.weekKey===l.weekKey);c&&n({isOpen:!0,week:c})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Category Composition"}),e.jsx(P,{width:"100%",height:280,children:e.jsxs(X,{data:i,layout:"vertical",margin:r?{top:5,right:10,left:5,bottom:5}:{top:5,right:30,left:80,bottom:5},onClick:l=>{l.isTooltipActive&&typeof l.activeTooltipIndex=="number"&&h(i[l.activeTooltipIndex])},children:[e.jsx(_,{type:"number",domain:[0,100],hide:!0}),e.jsx(G,{dataKey:"week",type:"category",width:r?50:75,tick:{fontSize:12}}),e.jsx(U,{formatter:l=>l!==void 0?`${Math.round(l)}%`:"N/A",contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-default)",borderRadius:"8px"},cursor:{fill:"var(--bg-inset)"}}),u.map(l=>e.jsx(M,{dataKey:l,stackId:"categories",fill:a.get(l)||"var(--color-neutral)",name:d.get(l)||l,isAnimationActive:!1,children:i.map((c,m)=>e.jsx(I,{opacity:c.opacity,cursor:"pointer"},`${l}-${m}`))},l))]})}),e.jsx("p",{className:"text-xs text-body",children:"Click a bar to see detailed category breakdown"})]}),t.isOpen&&t.week&&e.jsx(De,{week:t.week,colorMap:a,onClose:()=>n({isOpen:!1,week:null})})]})}function De({week:s,colorMap:t,onClose:n}){const o=g.useMemo(()=>[...s.categories].sort((a,i)=>i.count-a.count),[s.categories]);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-end z-50 sm:items-center",children:[e.jsxs("div",{className:"bg-[var(--bg-elevated)] w-full sm:w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl p-6 space-y-4 max-h-96 overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b border-[var(--border-default)]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-heading",children:["Week of ",T(s.start)]}),e.jsxs("p",{className:"text-sm text-body",children:[s.totalCount," events"]})]}),e.jsx("button",{onClick:n,className:"text-label hover:text-heading text-xl",children:"✕"})]}),e.jsx("div",{className:"space-y-3",children:o.map(a=>{const i=s.totalCount>0?Math.round(a.count/s.totalCount*100):0,u=t.get(a.categoryId);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:u}}),e.jsx("span",{className:"font-medium truncate text-heading",children:a.categoryName})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-sm text-body",children:[i,"%"]}),e.jsxs("span",{className:"text-sm font-semibold text-heading",children:["(",a.count,")"]})]})]}),e.jsx("div",{className:"bg-[var(--bg-inset)] rounded h-1.5",children:e.jsx("div",{className:"h-full rounded transition-all",style:{width:`${i}%`,backgroundColor:u}})})]},a.categoryId)})})]}),e.jsx("div",{className:"fixed inset-0 -z-10",onClick:n})]})}const Se={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Ee({categoryName:s,sentiment:t,sparklineData:n,currentCount:o,baselineAvg:a,deltaPercent:i,daysElapsed:u,onRemove:d}){const{t:r}=C("stats"),h=Se[t],l=Math.abs(i)<.1,c=Math.round(Math.abs(i)*100),m=g.useMemo(()=>l?r("goalCard.noMeaningfulChange"):`${i>0?"+":"−"}${c}%`,[l,i,c,r]),x=a*(u/7),f=g.useMemo(()=>{if(l)return null;const p=o-x,j=p>=0?"+":"−",v=Math.abs(p),N=Number.isInteger(v)?v.toString():v.toFixed(1),w=r("goalCard.event",{count:Math.round(v)});return`(${j}${N} ${w})`},[l,o,x,r]),y=Number.isInteger(a)?a.toString():a.toFixed(1);return e.jsxs("div",{className:"card p-4 flex flex-col justify-between relative group h-full min-h-[160px]",children:[e.jsx("button",{onClick:d,className:"absolute top-2 right-2 p-1 text-label opacity-60 sm:opacity-0 group-hover:opacity-100 transition-opacity hover:text-[var(--color-danger)]",title:r("goalCard.removeFromDashboard"),children:e.jsx(V,{className:"w-4 h-4",strokeWidth:2})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:h}}),e.jsx("span",{className:"text-xs font-medium text-label truncate max-w-[120px]",children:s})]}),e.jsxs("div",{className:"mt-1.5 space-y-0",children:[e.jsxs("div",{className:"text-sm font-semibold text-heading",children:[r("goalCard.thisWeek",{count:o}),u<7&&e.jsxs("span",{className:"text-xs font-normal text-label",children:[" ",r("goalCard.partialWeek",{day:u})]})]}),e.jsx("div",{className:"text-xs text-label",children:r("goalCard.baselineAvg",{count:Math.round(a),avg:y})})]}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-lg font-bold",style:{color:l?void 0:h},children:m}),f&&e.jsx("span",{className:"text-[10px] text-label",children:f}),!l&&u<7&&e.jsx("span",{className:"text-[10px] text-label",children:r("goalCard.vsPace")})]}),e.jsx("div",{className:"h-12 w-full -mx-2 mt-1",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(de,{data:n,children:[e.jsx(ue,{y:a,stroke:"var(--border-default)",strokeDasharray:"3 3",strokeWidth:1}),e.jsx(me,{type:"monotone",dataKey:"count",stroke:h,strokeWidth:2,dot:p=>{const{cx:j,cy:v,index:N}=p;return j==null||v==null||N==null?e.jsx(e.Fragment,{}):N===n.length-1?e.jsx(W,{cx:j,cy:v,r:4,fill:h,stroke:"var(--bg-card)",strokeWidth:2}):e.jsx(W,{cx:j,cy:v,r:2,fill:h,stroke:"none",opacity:.35})},isAnimationActive:!1})]})})})]})}function Ae({onClose:s}){const{t}=C("stats"),n=ae(),o=ne(),a=oe(),[i,u]=g.useState(""),d=g.useMemo(()=>new Set(n.map(c=>c.categoryId)),[n]),r=g.useMemo(()=>[...o.map(m=>({...m,type:"food"})),...a.map(m=>({...m,type:"activity"}))].sort((m,x)=>m.name.localeCompare(x.name)),[o,a]),h=g.useMemo(()=>{const c=i.toLowerCase().trim();return r.filter(m=>m.name.toLowerCase().includes(c))},[r,i]),l=c=>{d.has(c)||(z(c),s())};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"card w-full max-w-md bg-elevated shadow-elevated flex flex-col max-h-[80vh]",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:t("addCategoryModal.title")}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-inset rounded-full transition-colors",children:e.jsx(V,{className:"w-5 h-5",strokeWidth:2})})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:t("addCategoryModal.searchPlaceholder"),className:"form-input",value:i,onChange:c=>u(c.target.value),autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[h.map(c=>{const m=d.has(c.id);return e.jsxs("button",{onClick:()=>l(c.id),disabled:m,className:`w-full text-left px-3 py-2 rounded-md flex items-center justify-between transition-colors ${m?"opacity-50 cursor-not-allowed bg-inset":"hover:bg-inset"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:c.type==="food"?"var(--color-food)":"var(--color-activity)"}}),e.jsx("span",{className:"font-medium",children:c.name}),e.jsx("span",{className:"text-xs text-label px-1.5 py-0.5 rounded-full bg-inset capitalize",children:c.type})]}),m&&e.jsx("span",{className:"text-xs font-medium text-label",children:t("addCategoryModal.added")})]},c.id)}),h.length===0&&e.jsx("div",{className:"py-8 text-center text-label",children:t("addCategoryModal.noResults",{search:i})})]})]}),e.jsx("div",{className:"fixed inset-0 -z-10",onClick:s})]})}function Te(){const{t:s}=C("stats"),t=H(),[n,o]=g.useState(!1),a=g.useMemo(()=>F(8),[t.entries]),i=a[a.length-1],u=i?xe(i.start):7,d=g.useMemo(()=>t.dashboardCards?t.dashboardCards.map(r=>{const h=r.categoryId,l=t.foodCategories.find(b=>b.id===h),c=t.activityCategories.find(b=>b.id===h),m=l||c;if(!m)return null;const x=m.name,f=m.sentiment,y=a.map(b=>{const D={start:O(b.start),end:O(b.end)},se=re(Y(t.entries,D),h,t);return{week:b.key,count:se.length}}),p=y[y.length-1].count,N=y.slice(3,7).reduce((b,D)=>b+D.count,0)/4,w=N*(u/7),ee=p-w,te=w===0?p>0?1:0:ee/w;return{categoryId:h,categoryName:x,sentiment:f,sparklineData:y,currentCount:p,baselineAvg:N,deltaPercent:te,daysElapsed:u}}).filter(r=>r!==null):[],[t,a,u]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-heading",children:s("goalDashboard.title")}),e.jsx("button",{onClick:()=>o(!0),className:"text-sm font-medium transition-colors hover:opacity-80",style:{color:"var(--color-activity)"},children:s("goalDashboard.addToDashboard")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 overflow-y-auto pr-1",style:{maxHeight:"calc(3 * 180px + 2 * 1rem)"},children:[d.map(r=>e.jsx(Ee,{categoryName:r.categoryName,sentiment:r.sentiment,sparklineData:r.sparklineData,currentCount:r.currentCount,baselineAvg:r.baselineAvg,deltaPercent:r.deltaPercent,daysElapsed:r.daysElapsed,onRemove:()=>ie(r.categoryId)},r.categoryId)),d.length===0&&e.jsxs("div",{className:"col-span-full py-8 text-center card bg-inset border-dashed",children:[e.jsx("p",{className:"text-label text-sm",children:s("goalDashboard.noDashboardCards")}),e.jsx("button",{onClick:()=>o(!0),className:"mt-2 text-sm font-semibold",style:{color:"var(--color-activity)"},children:s("goalDashboard.addFirstCategory")})]})]}),n&&e.jsx(Ae,{onClose:()=>o(!1)})]})}function Pe(s,t){const n=new Map([...t.activityItems,...t.foodItems].map(a=>[a.id,a])),o=new Map;for(const a of s){const i=o.get(a.itemId);if(i)i.count++;else{const u=n.get(a.itemId);o.set(a.itemId,{id:a.itemId,name:u?.name??"Unknown",count:1,type:a.type})}}return Array.from(o.values()).sort((a,i)=>i.count-a.count)}function Fe(s,t){const n=new Map([...t.activityCategories,...t.foodCategories].map(a=>[a.id,a])),o=new Map;for(const a of s){const i=A(a,t);for(const u of i){const d=o.get(u);if(d)d.count++;else{const r=n.get(u);o.set(u,{id:u,name:r?.name??"Unknown",count:1,type:a.type})}}}return Array.from(o.values()).sort((a,i)=>i.count-a.count)}function Re({entries:s,data:t}){const{t:n}=C("stats"),[o,a]=g.useState("all"),[i,u]=g.useState("all"),[d,r]=g.useState("items"),h=g.useMemo(()=>o==="all"?s:Y(s,{start:ce((o==="7d"?7:30)-1),end:le()}),[s,o]),l=g.useMemo(()=>i==="all"?h:E(h,i),[h,i]),c=g.useMemo(()=>d==="items"?Pe(l,t):Fe(l,t),[l,t,d]),m=c.length>0?c[0].count:0;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-heading",children:n("frequencyRanking.title")}),e.jsx(k,{options:[{value:"all",label:n("frequencyRanking.timePeriod.all")},{value:"7d",label:n("frequencyRanking.timePeriod.7d")},{value:"30d",label:n("frequencyRanking.timePeriod.30d")}],value:o,onChange:a,variant:"segment",size:"sm"}),e.jsx(k,{options:[{value:"all",label:n("frequencyRanking.typeFilter.all"),activeClass:"bg-[var(--text-secondary)] text-white"},{value:"activity",label:n("frequencyRanking.typeFilter.activities"),activeClass:"type-activity"},{value:"food",label:n("frequencyRanking.typeFilter.food"),activeClass:"type-food"}],value:i,onChange:u,variant:"segment",size:"sm"}),e.jsx(k,{options:[{value:"items",label:n("frequencyRanking.viewMode.items")},{value:"categories",label:n("frequencyRanking.viewMode.categories")}],value:d,onChange:r,variant:"segment",size:"sm"}),c.length===0?e.jsx("p",{className:"text-sm text-label text-center py-4",children:n("frequencyRanking.empty",{viewMode:n(`frequencyRanking.viewMode.${d}`).toLowerCase()})}):e.jsx("div",{className:"space-y-1.5",children:c.map((x,f)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted w-5 text-right shrink-0",children:f+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsx("span",{className:"text-sm text-heading truncate",children:x.name}),e.jsx("span",{className:"text-xs text-label shrink-0",children:x.count})]}),e.jsx("div",{className:"h-1 rounded-full bg-[var(--bg-inset)] overflow-hidden",children:e.jsx("div",{className:K("h-full rounded-full transition-all",x.type==="activity"?"bg-[var(--color-activity)]":"bg-[var(--color-food)]"),style:{width:`${x.count/m*100}%`}})})]})]},x.id))})]})}function We(){const{t:s}=C("stats"),t=H(),[n,o]=g.useState("weekly"),a=g.useMemo(()=>F(8),[]),i=g.useMemo(()=>fe(t.entries,t,a),[t,a]),u=g.useMemo(()=>i.some(d=>d.totalCount>0),[i]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s("title")}),e.jsx("p",{className:"text-body",children:s("subtitle")})]}),e.jsx(k,{options:[{value:"weekly",label:s("period.weekly")},{value:"monthly",label:s("period.monthly"),disabled:!0,title:s("period.monthlyComingSoon")}],value:n,onChange:o,variant:"segment",size:"sm"}),!u&&e.jsxs("div",{className:"card p-8 text-center space-y-2",children:[e.jsx("p",{className:"text-body",children:s("empty.noFoodEntries")}),e.jsx("p",{className:"text-sm text-label",children:s("empty.startLogging")})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx("hr",{className:"border-[var(--border-default)]"}),e.jsx(we,{weeklyData:i}),e.jsx(Me,{data:t}),e.jsx(Ie,{weeklyData:i})]}),t.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-[var(--border-default)]"}),e.jsx(Re,{entries:t.entries,data:t})]})]})}export{Me as ActionableCategories,Ae as AddCategoryModal,we as BalanceOverview,Ie as CategoryComposition,Re as FrequencyRanking,Ee as GoalCard,Te as GoalDashboard,We as StatsPage};
