{"version":3,"file":"index-DhCO6a5k.js","sources":["../../src/features/stats/utils/stats-engine.ts","../../src/shared/hooks/useIsMobile.ts","../../src/features/stats/components/BalanceOverview.tsx","../../src/features/stats/components/ActionableCategories.tsx","../../src/features/stats/components/CategoryComposition.tsx","../../src/features/stats/components/GoalCard.tsx","../../src/features/stats/components/AddCategoryModal.tsx","../../src/features/stats/components/GoalDashboard.tsx","../../src/features/stats/components/FrequencyRanking.tsx","../../src/features/stats/components/StatsPage.tsx","../../src/features/stats/components/WeekBreakdownTooltip.tsx","../../src/features/stats/components/CategoryTrendChart.tsx","../../src/features/stats/components/WeekHistoryGrid.tsx","../../src/features/stats/components/CategoryDetailPage.tsx"],"sourcesContent":["import type { Entry, TrackerData } from '@/shared/lib/types';\nimport { getCategories } from '@/shared/lib/types';\nimport { getCategoryNameById, getEntryCategoryIds, filterEntriesByType } from '@/features/tracking';\n\n// Re-export formatWeekLabel for consumers\nexport { formatWeekLabel } from '@/shared/lib/date-utils';\n\nexport type PeriodType = 'weekly' | 'monthly';\n\n/**\n * Get the ISO week number and year for a date\n */\nfunction getISOWeek(date: Date): { year: number; week: number } {\n\tconst d = new Date(date);\n\td.setHours(0, 0, 0, 0);\n\td.setDate(d.getDate() + 4 - (d.getDay() || 7));\n\tconst yearStart = new Date(d.getFullYear(), 0, 1);\n\tconst weekNumber = Math.ceil(((d.getTime() - yearStart.getTime()) / 86400000 + 1) / 7);\n\treturn { year: d.getFullYear(), week: weekNumber };\n}\n\n/**\n * Get the Monday of a given ISO week\n */\nexport function getWeekStartDate(year: number, week: number): Date {\n\tconst simple = new Date(year, 0, 1 + (week - 1) * 7);\n\tconst dow = simple.getDay();\n\tconst ISOweekStart = simple;\n\tif (dow <= 4) {\n\t\tISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);\n\t} else {\n\t\tISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());\n\t}\n\treturn ISOweekStart;\n}\n\n/**\n * Format week key as \"YYYY-W##\"\n */\nfunction getWeekKey(date: Date): string {\n\tconst { year, week } = getISOWeek(date);\n\treturn `${year}-W${String(week).padStart(2, '0')}`;\n}\n\n/**\n * Get last N weeks of data (default 8)\n */\nexport function getLastNWeeks(count: number = 8): Array<{ key: string; start: Date; end: Date }> {\n\tconst weeks: Array<{ key: string; start: Date; end: Date }> = [];\n\tconst today = new Date();\n\n\tfor (let i = count - 1; i >= 0; i--) {\n\t\tconst date = new Date(today);\n\t\tdate.setDate(date.getDate() - i * 7);\n\t\tconst key = getWeekKey(date);\n\t\tconst start = getWeekStartDate(date.getFullYear(), getISOWeek(date).week);\n\t\tconst end = new Date(start);\n\t\tend.setDate(end.getDate() + 6);\n\n\t\t// Check if we already have this week\n\t\tif (!weeks.find((w) => w.key === key)) {\n\t\t\tweeks.push({ key, start, end });\n\t\t}\n\t}\n\n\treturn weeks;\n}\n\n/**\n * Calculate how many days have elapsed in the current week (1–7).\n * Compares the week's start (Monday) to today. Accepts an optional\n * `today` parameter for testing.\n */\nexport function getDaysElapsedInCurrentWeek(weekStart: Date, today?: Date): number {\n\tconst now = today ? new Date(today) : new Date();\n\tnow.setHours(0, 0, 0, 0);\n\tconst start = new Date(weekStart);\n\tstart.setHours(0, 0, 0, 0);\n\tconst diffMs = now.getTime() - start.getTime();\n\tconst diffDays = Math.floor(diffMs / 86400000) + 1; // +1 to include today\n\treturn Math.max(1, Math.min(7, diffDays));\n}\n\n/**\n * Check if an entry's date falls within a week\n */\nfunction isEntryInWeek(entry: Entry, weekStart: Date, weekEnd: Date): boolean {\n\tconst entryDate = new Date(entry.date + 'T00:00:00');\n\treturn entryDate >= weekStart && entryDate <= weekEnd;\n}\n\n/**\n * Category data for a single week\n */\nexport interface WeeklyCategoryData {\n\tcategoryId: string;\n\tcategoryName: string;\n\tsentiment: 'positive' | 'neutral' | 'limit';\n\tcount: number;\n\tcolor?: string;\n}\n\n/**\n * Weekly breakdown with sentiment distribution\n */\nexport interface WeeklyData {\n\tweekKey: string;\n\tstart: Date;\n\tend: Date;\n\tentries: Entry[];\n\ttotalCount: number;\n\tcategories: WeeklyCategoryData[];\n\tsentimentCounts: {\n\t\tpositive: number;\n\t\tneutral: number;\n\t\tlimit: number;\n\t};\n\thasLowData: boolean;\n}\n\n/**\n * Process food entries for last N weeks\n */\nexport function processFoodEntriesByWeek(\n\tentries: Entry[],\n\tdata: TrackerData,\n\tweeks: Array<{ key: string; start: Date; end: Date }>,\n): WeeklyData[] {\n\tconst foodEntries = filterEntriesByType(entries, 'food');\n\tconst foodCategories = getCategories(data, 'food');\n\n\treturn weeks.map((week) => {\n\t\tconst weekEntries = foodEntries.filter((e: Entry) => isEntryInWeek(e, week.start, week.end));\n\n\t\t// Build category map with sentiment\n\t\tconst categoryMap = new Map<string, WeeklyCategoryData>();\n\n\t\tweekEntries.forEach((entry: Entry) => {\n\t\t\tconst catIds = getEntryCategoryIds(entry, data);\n\t\t\tcatIds.forEach((catId: string) => {\n\t\t\t\tconst catName = getCategoryNameById(catId, data);\n\t\t\t\tconst category = foodCategories.find((c) => c.id === catId);\n\t\t\t\tconst sentiment = category?.sentiment ?? 'neutral';\n\n\t\t\t\tif (!categoryMap.has(catId)) {\n\t\t\t\t\tcategoryMap.set(catId, {\n\t\t\t\t\t\tcategoryId: catId,\n\t\t\t\t\t\tcategoryName: catName,\n\t\t\t\t\t\tsentiment,\n\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst existing = categoryMap.get(catId)!;\n\t\t\t\texisting.count += 1;\n\t\t\t});\n\t\t});\n\n\t\t// Calculate sentiment totals\n\t\tconst categories = Array.from(categoryMap.values());\n\t\tconst sentimentCounts = {\n\t\t\tpositive: categories.filter((c) => c.sentiment === 'positive').reduce((s, c) => s + c.count, 0),\n\t\t\tneutral: categories.filter((c) => c.sentiment === 'neutral').reduce((s, c) => s + c.count, 0),\n\t\t\tlimit: categories.filter((c) => c.sentiment === 'limit').reduce((s, c) => s + c.count, 0),\n\t\t};\n\n\t\treturn {\n\t\t\tweekKey: week.key,\n\t\t\tstart: week.start,\n\t\t\tend: week.end,\n\t\t\tentries: weekEntries,\n\t\t\ttotalCount: weekEntries.length,\n\t\t\tcategories,\n\t\t\tsentimentCounts,\n\t\t\thasLowData: weekEntries.length < 5,\n\t\t};\n\t});\n}\n\n/**\n * Calculate balance score for a week\n */\nexport function calculateBalanceScore(weeklyData: WeeklyData): number {\n\tconst { positive, limit } = weeklyData.sentimentCounts;\n\tif (positive + limit === 0) return 0;\n\treturn (positive / (positive + limit)) * 100;\n}\n\n/**\n * Determine score change direction\n */\nexport function getScoreChange(\n\tcurrent: number,\n\tprevious: number,\n): { direction: 'up' | 'down' | 'stable'; percentChange: number } {\n\tif (previous === 0) return { direction: 'stable', percentChange: 0 };\n\tconst change = ((current - previous) / previous) * 100;\n\tif (Math.abs(change) < 1) return { direction: 'stable', percentChange: 0 };\n\treturn {\n\t\tdirection: change > 0 ? 'up' : 'down',\n\t\tpercentChange: Math.round(Math.abs(change)),\n\t};\n}\n\n/**\n * Get top N categories across all weeks\n */\nexport function getTopCategories(allWeeklyData: WeeklyData[], limit: number = 9): string[] {\n\tconst categoryTotals = new Map<string, number>();\n\n\tallWeeklyData.forEach((week) => {\n\t\tweek.categories.forEach((cat) => {\n\t\t\tcategoryTotals.set(cat.categoryId, (categoryTotals.get(cat.categoryId) || 0) + cat.count);\n\t\t});\n\t});\n\n\treturn Array.from(categoryTotals.entries())\n\t\t.sort((a, b) => b[1] - a[1])\n\t\t.slice(0, limit)\n\t\t.map(([catId]) => catId);\n}\n\n/**\n * Get chart color palette from CSS variables\n */\nfunction getChartColors(): string[] {\n\tif (typeof document === 'undefined') {\n\t\t// Fallback for SSR/tests\n\t\treturn ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#06b6d4', '#f97316', '#6366f1'];\n\t}\n\tconst styles = getComputedStyle(document.documentElement);\n\treturn [\n\t\tstyles.getPropertyValue('--chart-color-1').trim(),\n\t\tstyles.getPropertyValue('--chart-color-2').trim(),\n\t\tstyles.getPropertyValue('--chart-color-3').trim(),\n\t\tstyles.getPropertyValue('--chart-color-4').trim(),\n\t\tstyles.getPropertyValue('--chart-color-5').trim(),\n\t\tstyles.getPropertyValue('--chart-color-6').trim(),\n\t\tstyles.getPropertyValue('--chart-color-7').trim(),\n\t\tstyles.getPropertyValue('--chart-color-8').trim(),\n\t\tstyles.getPropertyValue('--chart-color-9').trim(),\n\t];\n}\n\n/**\n * Assign colors to top categories by rank order to guarantee unique colors.\n */\nexport function buildCategoryColorMap(topCategoryIds: string[]): Map<string, string> {\n\tconst chartColors = getChartColors();\n\tconst map = new Map<string, string>();\n\ttopCategoryIds.forEach((catId, index) => {\n\t\tmap.set(catId, chartColors[index % chartColors.length]);\n\t});\n\tmap.set('OTHER', 'var(--color-neutral)');\n\treturn map;\n}\n\n/**\n * Group category data for a week, showing top N + \"Other\"\n */\nexport function groupCategoriesForWeek(\n\tweek: WeeklyData,\n\ttopCategoryIds: string[],\n): Array<{ categoryId: string; categoryName: string; sentiment: string; count: number }> {\n\tconst grouped = [];\n\tlet otherCount = 0;\n\n\tweek.categories.forEach((cat) => {\n\t\tif (topCategoryIds.includes(cat.categoryId)) {\n\t\t\tgrouped.push(cat);\n\t\t} else {\n\t\t\totherCount += cat.count;\n\t\t}\n\t});\n\n\tif (otherCount > 0) {\n\t\tgrouped.push({\n\t\t\tcategoryId: 'OTHER',\n\t\t\tcategoryName: 'Other',\n\t\t\tsentiment: 'neutral',\n\t\t\tcount: otherCount,\n\t\t});\n\t}\n\n\t// Sort by top category order\n\treturn grouped.sort((a, b) => {\n\t\tconst aIdx = topCategoryIds.indexOf(a.categoryId);\n\t\tconst bIdx = topCategoryIds.indexOf(b.categoryId);\n\t\tif (aIdx === -1) return 1; // \"Other\" goes last\n\t\tif (bIdx === -1) return -1;\n\t\treturn aIdx - bIdx;\n\t});\n}\n\n// ============================================================\n// Actionable Categories — used by the stats \"Follow\" section\n// ============================================================\n\nexport interface ActionableCategoryRow {\n\tcategoryId: string;\n\tcategoryName: string;\n\t/** Primary metric value (count for limit, gap for positive) */\n\tvalue: number;\n\t/** Human-readable secondary label, e.g. \"32% of limit total\" */\n\tlabel: string;\n\t/** Raw event count. Only populated for limit categories; undefined for positive categories. */\n\tcount?: number;\n}\n\n/**\n * Collect food entries from the last 4 weeks and count occurrences for\n * categories matching the given sentiment.\n */\nfunction countCategoriesBySentiment(\n\tentries: Entry[],\n\tdata: TrackerData,\n\tweeks: Array<{ key: string; start: Date; end: Date }>,\n\tsentiment: 'limit' | 'positive',\n): { counts: Map<string, number>; total: number; catIds: Set<string> } {\n\tconst foodCategories = getCategories(data, 'food');\n\tconst catIds = new Set(foodCategories.filter((c) => c.sentiment === sentiment).map((c) => c.id));\n\n\tconst counts = new Map<string, number>();\n\tlet total = 0;\n\n\tif (catIds.size === 0) return { counts, total, catIds };\n\n\t// Determine the full date range from the last 4 weeks and filter once\n\tconst last4 = weeks.slice(-4);\n\tconst rangeStart = last4[0].start;\n\tconst rangeEnd = last4[last4.length - 1].end;\n\tconst foodEntries = filterEntriesByType(entries, 'food').filter((e) => isEntryInWeek(e, rangeStart, rangeEnd));\n\n\tfor (const entry of foodEntries) {\n\t\tconst entryCatIds = getEntryCategoryIds(entry, data);\n\t\tfor (const catId of entryCatIds) {\n\t\t\tif (catIds.has(catId)) {\n\t\t\t\tcounts.set(catId, (counts.get(catId) || 0) + 1);\n\t\t\t\ttotal++;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { counts, total, catIds };\n}\n\n/**\n * Extract the ISO week number from a week key like \"2026-W09\".\n */\nexport function getWeekNumber(weekKey: string): number {\n\tconst match = weekKey.match(/W(\\d+)$/);\n\treturn match ? parseInt(match[1], 10) : 0;\n}\n\n/**\n * Get per-day-of-week counts for entries within a week.\n * Returns an array of 7 objects (Mon–Sun) with day label and count.\n */\nexport function getDailyBreakdown(\n\tentries: Entry[],\n\tweekStart: Date,\n\tweekEnd: Date,\n): Array<{ day: string; count: number }> {\n\tconst dayLabels = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];\n\tconst counts = [0, 0, 0, 0, 0, 0, 0];\n\n\tfor (const entry of entries) {\n\t\tconst entryDate = new Date(entry.date + 'T00:00:00');\n\t\tif (entryDate >= weekStart && entryDate <= weekEnd) {\n\t\t\t// getDay() returns 0=Sun, 1=Mon, ... 6=Sat → shift to Mon-first\n\t\t\tconst jsDay = entryDate.getDay();\n\t\t\tconst idx = jsDay === 0 ? 6 : jsDay - 1;\n\t\t\tcounts[idx]++;\n\t\t}\n\t}\n\n\treturn dayLabels.map((day, i) => ({ day, count: counts[i] }));\n}\n\n/**\n * Top Limit Categories (last 4 weeks)\n */\nexport function getTopLimitCategories(\n\tentries: Entry[],\n\tdata: TrackerData,\n\tweeks: Array<{ key: string; start: Date; end: Date }>,\n\tlimit: number = 5,\n): ActionableCategoryRow[] {\n\tconst { counts, total } = countCategoriesBySentiment(entries, data, weeks, 'limit');\n\tif (total === 0) return [];\n\n\treturn Array.from(counts.entries())\n\t\t.sort((a, b) => b[1] - a[1])\n\t\t.slice(0, limit)\n\t\t.map(([catId, count]) => {\n\t\t\tconst share = Math.round((count / total) * 100);\n\t\t\tconst catName = getCategoryNameById(catId, data);\n\t\t\treturn {\n\t\t\t\tcategoryId: catId,\n\t\t\t\tcategoryName: catName,\n\t\t\t\tvalue: share,\n\t\t\t\tlabel: `${share}% of limit total`,\n\t\t\t\tcount,\n\t\t\t};\n\t\t});\n}\n\n/**\n * Lagging Positive Categories (last 4 weeks)\n */\nexport function getLaggingPositiveCategories(\n\tentries: Entry[],\n\tdata: TrackerData,\n\tweeks: Array<{ key: string; start: Date; end: Date }>,\n\tlimit: number = 5,\n): ActionableCategoryRow[] {\n\tconst { counts, total, catIds } = countCategoriesBySentiment(entries, data, weeks, 'positive');\n\tif (total === 0) return [];\n\n\t// Ensure every positive category appears (even with 0 count)\n\tfor (const catId of catIds) {\n\t\tif (!counts.has(catId)) {\n\t\t\tcounts.set(catId, 0);\n\t\t}\n\t}\n\n\tconst avgShare = 1 / catIds.size;\n\n\treturn Array.from(counts.entries())\n\t\t.map(([catId, count]) => {\n\t\t\tconst share = count / total;\n\t\t\tconst gap = avgShare - share;\n\t\t\treturn { catId, count, share, gap };\n\t\t})\n\t\t.filter((r) => r.gap > 0)\n\t\t.sort((a, b) => b.gap - a.gap)\n\t\t.slice(0, limit)\n\t\t.map((r) => {\n\t\t\tconst catName = getCategoryNameById(r.catId, data);\n\t\t\tconst gapPercent = Math.round(r.gap * 100);\n\t\t\treturn {\n\t\t\t\tcategoryId: r.catId,\n\t\t\t\tcategoryName: catName,\n\t\t\t\tvalue: gapPercent,\n\t\t\t\tlabel: 'Below your positive average',\n\t\t\t};\n\t\t});\n}\n","import { useSyncExternalStore, useCallback } from 'react';\n\nexport function useIsMobile(breakpoint = 640): boolean {\n\tconst subscribe = useCallback(\n\t\t(cb: () => void) => {\n\t\t\tconst mql = window.matchMedia(`(max-width: ${breakpoint - 1}px)`);\n\t\t\tmql.addEventListener('change', cb);\n\t\t\treturn () => mql.removeEventListener('change', cb);\n\t\t},\n\t\t[breakpoint],\n\t);\n\n\tconst getSnapshot = useCallback(() => {\n\t\treturn window.matchMedia(`(max-width: ${breakpoint - 1}px)`).matches;\n\t}, [breakpoint]);\n\n\treturn useSyncExternalStore(subscribe, getSnapshot, () => false);\n}\n","import { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { BarChart, Bar, XAxis, YAxis, Cell, Tooltip, ResponsiveContainer } from 'recharts';\nimport type { WeeklyData } from '../utils/stats-engine';\nimport { calculateBalanceScore, getScoreChange, formatWeekLabel } from '../utils/stats-engine';\nimport { useIsMobile } from '@/shared/hooks/useIsMobile';\n\ninterface BalanceOverviewProps {\n\tweeklyData: WeeklyData[];\n}\n\nexport default function BalanceOverview({ weeklyData }: BalanceOverviewProps) {\n\tconst { t } = useTranslation('stats');\n\tconst data = useMemo(() => {\n\t\treturn weeklyData.map((week) => {\n\t\t\tconst { positive, neutral, limit } = week.sentimentCounts;\n\t\t\tconst total = positive + neutral + limit;\n\n\t\t\treturn {\n\t\t\t\tweek: formatWeekLabel(week.start),\n\t\t\t\tpositive: total > 0 ? (positive / total) * 100 : 0,\n\t\t\t\tneutral: total > 0 ? (neutral / total) * 100 : 0,\n\t\t\t\tlimit: total > 0 ? (limit / total) * 100 : 0,\n\t\t\t\topacity: week.hasLowData ? 0.4 : 1,\n\t\t\t};\n\t\t});\n\t}, [weeklyData]);\n\n\tconst currentScore = useMemo(() => {\n\t\tif (weeklyData.length === 0) return 0;\n\t\treturn calculateBalanceScore(weeklyData[weeklyData.length - 1]);\n\t}, [weeklyData]);\n\n\tconst previousScore = useMemo(() => {\n\t\tif (weeklyData.length < 2) return currentScore;\n\t\treturn calculateBalanceScore(weeklyData[weeklyData.length - 2]);\n\t}, [weeklyData, currentScore]);\n\n\tconst scoreChange = useMemo(() => {\n\t\treturn getScoreChange(currentScore, previousScore);\n\t}, [currentScore, previousScore]);\n\n\tconst isMobile = useIsMobile();\n\n\treturn (\n\t\t<div className=\"space-y-4 sm:space-y-6\">\n\t\t\t{/* Score Card */}\n\t\t\t<div className=\"card p-4 sm:p-6 space-y-4\">\n\t\t\t\t<div className=\"flex items-baseline justify-between\">\n\t\t\t\t\t<h3 className=\"text-lg font-semibold\">{t('balanceOverview.scoreTitle')}</h3>\n\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<span className=\"text-4xl font-bold\" style={{ color: 'var(--color-activity)' }}>\n\t\t\t\t\t\t\t{Math.round(currentScore)}%\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{scoreChange.direction !== 'stable' && (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"text-sm font-semibold flex items-center gap-1\"\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tcolor: scoreChange.direction === 'up' ? 'var(--color-success)' : 'var(--color-danger)',\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{scoreChange.direction === 'up' ? '↑' : '↓'}</span>\n\t\t\t\t\t\t\t\t<span>{scoreChange.percentChange}%</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Score meter */}\n\t\t\t\t<div className=\"bg-[var(--bg-inset)] rounded-full h-4 overflow-hidden\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"h-full transition-all duration-300\"\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\twidth: `${currentScore}%`,\n\t\t\t\t\t\t\tbackground: `linear-gradient(to right, var(--color-danger), var(--color-warning), var(--color-success))`,\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<p className=\"text-xs text-body\">{t('balanceOverview.scoreMeterDescription')}</p>\n\t\t\t</div>\n\n\t\t\t{/* Weekly breakdown chart */}\n\t\t\t<div className=\"card p-4 sm:p-6 space-y-4\">\n\t\t\t\t<h3 className=\"text-lg font-semibold\">{t('balanceOverview.weeklyBreakdownTitle')}</h3>\n\t\t\t\t<ResponsiveContainer width=\"100%\" height={280}>\n\t\t\t\t\t<BarChart\n\t\t\t\t\t\tdata={data}\n\t\t\t\t\t\tlayout=\"vertical\"\n\t\t\t\t\t\tmargin={isMobile ? { top: 5, right: 10, left: 5, bottom: 5 } : { top: 5, right: 30, left: 80, bottom: 5 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<XAxis type=\"number\" domain={[0, 100]} hide />\n\t\t\t\t\t\t<YAxis dataKey=\"week\" type=\"category\" width={isMobile ? 50 : 75} tick={{ fontSize: 12 }} />\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tformatter={(value: number | undefined) => (value !== undefined ? `${Math.round(value)}%` : 'N/A')}\n\t\t\t\t\t\t\tcontentStyle={{\n\t\t\t\t\t\t\t\tbackground: 'var(--bg-card)',\n\t\t\t\t\t\t\t\tborder: '1px solid var(--border-default)',\n\t\t\t\t\t\t\t\tborderRadius: '8px',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Bar\n\t\t\t\t\t\t\tdataKey=\"positive\"\n\t\t\t\t\t\t\tstackId=\"sentiment\"\n\t\t\t\t\t\t\tfill=\"var(--color-success)\"\n\t\t\t\t\t\t\tname={t('balanceOverview.chartPositive')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{data.map((entry, index) => (\n\t\t\t\t\t\t\t\t<Cell key={`positive-${index}`} opacity={entry.opacity} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Bar>\n\t\t\t\t\t\t<Bar\n\t\t\t\t\t\t\tdataKey=\"neutral\"\n\t\t\t\t\t\t\tstackId=\"sentiment\"\n\t\t\t\t\t\t\tfill=\"var(--color-neutral)\"\n\t\t\t\t\t\t\tname={t('balanceOverview.chartNeutral')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{data.map((entry, index) => (\n\t\t\t\t\t\t\t\t<Cell key={`neutral-${index}`} opacity={entry.opacity} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Bar>\n\t\t\t\t\t\t<Bar dataKey=\"limit\" stackId=\"sentiment\" fill=\"var(--color-danger)\" name={t('balanceOverview.chartLimit')}>\n\t\t\t\t\t\t\t{data.map((entry, index) => (\n\t\t\t\t\t\t\t\t<Cell key={`limit-${index}`} opacity={entry.opacity} />\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Bar>\n\t\t\t\t\t</BarChart>\n\t\t\t\t</ResponsiveContainer>\n\t\t\t\t<p className=\"text-xs text-body\">{t('balanceOverview.lowDataWarning')}</p>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport type { TrackerData } from '@/shared/lib/types';\nimport type { ActionableCategoryRow } from '../utils/stats-engine';\nimport { getLastNWeeks, getTopLimitCategories, getLaggingPositiveCategories } from '../utils/stats-engine';\nimport { addDashboardCard } from '@/shared/store/store';\nimport { showToast } from '@/shared/ui/Toast';\nimport { useIsMobile } from '@/shared/hooks/useIsMobile';\nimport { cn } from '@/shared/lib/cn';\n\nconst MAX_DASHBOARD_CARDS = 6;\n\ninterface ActionableCategoriesProps {\n\tdata: TrackerData;\n}\n\nexport default function ActionableCategories({ data }: ActionableCategoriesProps) {\n\tconst { t } = useTranslation('stats');\n\tconst weeks = useMemo(() => getLastNWeeks(8), []);\n\n\tconst limitRows = useMemo(() => getTopLimitCategories(data.entries, data, weeks), [data, weeks]);\n\n\tconst positiveRows = useMemo(() => getLaggingPositiveCategories(data.entries, data, weeks), [data, weeks]);\n\n\tconst followedIds = useMemo(() => {\n\t\treturn new Set((data.dashboardCards || []).map((c) => c.categoryId));\n\t}, [data.dashboardCards]);\n\n\tconst cardCount = data.dashboardCards?.length ?? 0;\n\n\tif (limitRows.length === 0 && positiveRows.length === 0) return null;\n\n\tfunction handleFollow(categoryId: string, categoryName: string) {\n\t\tif (followedIds.has(categoryId)) return;\n\t\tif (cardCount >= MAX_DASHBOARD_CARDS) {\n\t\t\tshowToast(t('focusAreas.dashboardFull'));\n\t\t\treturn;\n\t\t}\n\t\taddDashboardCard(categoryId);\n\t\tshowToast(t('focusAreas.addedToDashboard', { name: categoryName }));\n\t}\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<h2 className=\"text-xl font-bold text-heading\">{t('focusAreas.title')}</h2>\n\n\t\t\t<div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n\t\t\t\t{limitRows.length > 0 && (\n\t\t\t\t\t<Panel\n\t\t\t\t\t\ttitle={t('focusAreas.limitPanel.title')}\n\t\t\t\t\t\tsubtitle={t('focusAreas.limitPanel.subtitle')}\n\t\t\t\t\t\trows={limitRows}\n\t\t\t\t\t\taccent=\"limit\"\n\t\t\t\t\t\tfollowedIds={followedIds}\n\t\t\t\t\t\tonFollow={handleFollow}\n\t\t\t\t\t\tfollowingLabel={t('focusAreas.following')}\n\t\t\t\t\t\tfollowLabel={t('focusAreas.follow')}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{positiveRows.length > 0 && (\n\t\t\t\t\t<Panel\n\t\t\t\t\t\ttitle={t('focusAreas.positivePanel.title')}\n\t\t\t\t\t\tsubtitle={t('focusAreas.positivePanel.subtitle')}\n\t\t\t\t\t\trows={positiveRows}\n\t\t\t\t\t\taccent=\"positive\"\n\t\t\t\t\t\tfollowedIds={followedIds}\n\t\t\t\t\t\tonFollow={handleFollow}\n\t\t\t\t\t\tfollowingLabel={t('focusAreas.following')}\n\t\t\t\t\t\tfollowLabel={t('focusAreas.follow')}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\ninterface PanelProps {\n\ttitle: string;\n\tsubtitle: string;\n\trows: ActionableCategoryRow[];\n\taccent: 'limit' | 'positive';\n\tfollowedIds: Set<string>;\n\tonFollow: (categoryId: string, categoryName: string) => void;\n\tfollowingLabel: string;\n\tfollowLabel: string;\n}\n\nfunction Panel({ title, subtitle, rows, accent, followedIds, onFollow, followingLabel, followLabel }: PanelProps) {\n\tconst isMobile = useIsMobile();\n\tconst barColor = accent === 'limit' ? 'var(--color-danger)' : 'var(--color-food)';\n\tconst maxValue = Math.max(...rows.map((r) => r.value), 1);\n\n\treturn (\n\t\t<div className=\"card p-4 space-y-3\">\n\t\t\t<div>\n\t\t\t\t<h3 className=\"text-sm font-semibold text-heading\">{title}</h3>\n\t\t\t\t<p className=\"text-xs text-label mt-0.5\">{subtitle}</p>\n\t\t\t</div>\n\n\t\t\t<div className=\"space-y-2\">\n\t\t\t\t{rows.map((row) => {\n\t\t\t\t\tconst isFollowed = followedIds.has(row.categoryId);\n\t\t\t\t\tconst barWidth = Math.max((row.value / maxValue) * 100, 4);\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={row.categoryId} className=\"group\">\n\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2 mb-0.5\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-medium text-heading truncate\">{row.categoryName}</span>\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-label whitespace-nowrap\">{row.label}</span>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tonClick={() => onFollow(row.categoryId, row.categoryName)}\n\t\t\t\t\t\t\t\t\tdisabled={isFollowed}\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t'text-xs font-medium px-2 py-0.5 rounded transition-colors whitespace-nowrap',\n\t\t\t\t\t\t\t\t\t\tisFollowed ? 'text-label cursor-default' : 'text-body hover:bg-[var(--bg-inset)]',\n\t\t\t\t\t\t\t\t\t\t!isMobile && !isFollowed && 'sm:opacity-0 sm:group-hover:opacity-100',\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{isFollowed ? followingLabel : followLabel}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div className=\"h-2 rounded-full bg-[var(--bg-inset)] overflow-hidden\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"h-full rounded-full transition-all duration-300\"\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\twidth: `${barWidth}%`,\n\t\t\t\t\t\t\t\t\t\tbackgroundColor: barColor,\n\t\t\t\t\t\t\t\t\t\topacity: 0.7,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { useMemo, useState } from 'react';\nimport { BarChart, Bar, XAxis, YAxis, Cell, Tooltip, ResponsiveContainer } from 'recharts';\nimport type { WeeklyData } from '../utils/stats-engine';\nimport {\n\tgetTopCategories,\n\tbuildCategoryColorMap,\n\tgroupCategoriesForWeek,\n\tformatWeekLabel,\n} from '../utils/stats-engine';\nimport { useIsMobile } from '@/shared/hooks/useIsMobile';\n\ninterface CategoryCompositionProps {\n\tweeklyData: WeeklyData[];\n}\n\ninterface ModalState {\n\tisOpen: boolean;\n\tweek: WeeklyData | null;\n}\n\nexport default function CategoryComposition({ weeklyData }: CategoryCompositionProps) {\n\tconst [modal, setModal] = useState<ModalState>({ isOpen: false, week: null });\n\n\tconst topCategoryIds = useMemo(() => {\n\t\treturn getTopCategories(weeklyData, 9);\n\t}, [weeklyData]);\n\n\tconst colorMap = useMemo(() => {\n\t\treturn buildCategoryColorMap(topCategoryIds);\n\t}, [topCategoryIds]);\n\n\tconst chartData = useMemo(() => {\n\t\treturn weeklyData.map((week) => {\n\t\t\tconst grouped = groupCategoriesForWeek(week, topCategoryIds);\n\t\t\tconst totalCategoryCount = grouped.reduce((sum, c) => sum + c.count, 0);\n\t\t\tconst dataPoint: Record<string, number | string> = {\n\t\t\t\tweek: formatWeekLabel(week.start),\n\t\t\t\tweekKey: week.weekKey,\n\t\t\t\topacity: week.hasLowData ? 0.4 : 1,\n\t\t\t};\n\n\t\t\tgrouped.forEach((cat) => {\n\t\t\t\tdataPoint[cat.categoryId] = totalCategoryCount > 0 ? (cat.count / totalCategoryCount) * 100 : 0;\n\t\t\t});\n\n\t\t\treturn dataPoint;\n\t\t});\n\t}, [weeklyData, topCategoryIds]);\n\n\tconst allCategoryIds = useMemo(() => {\n\t\treturn [...topCategoryIds, 'OTHER'];\n\t}, [topCategoryIds]);\n\n\tconst categoryNameMap = useMemo(() => {\n\t\tconst map = new Map<string, string>();\n\t\tweeklyData.forEach((week) => {\n\t\t\tweek.categories.forEach((cat) => {\n\t\t\t\tif (!map.has(cat.categoryId)) {\n\t\t\t\t\tmap.set(cat.categoryId, cat.categoryName);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tmap.set('OTHER', 'Other');\n\t\treturn map;\n\t}, [weeklyData]);\n\n\tconst isMobile = useIsMobile();\n\n\tconst handleBarClick = (data: { weekKey?: string }) => {\n\t\tconst week = weeklyData.find((w) => w.weekKey === data.weekKey);\n\t\tif (week) {\n\t\t\tsetModal({ isOpen: true, week });\n\t\t}\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"card p-4 sm:p-6 space-y-4\">\n\t\t\t\t<h3 className=\"text-lg font-semibold\">Category Composition</h3>\n\t\t\t\t<ResponsiveContainer width=\"100%\" height={280}>\n\t\t\t\t\t<BarChart\n\t\t\t\t\t\tdata={chartData}\n\t\t\t\t\t\tlayout=\"vertical\"\n\t\t\t\t\t\tmargin={isMobile ? { top: 5, right: 10, left: 5, bottom: 5 } : { top: 5, right: 30, left: 80, bottom: 5 }}\n\t\t\t\t\t\tonClick={(state) => {\n\t\t\t\t\t\t\tif (state.isTooltipActive && typeof state.activeTooltipIndex === 'number') {\n\t\t\t\t\t\t\t\thandleBarClick(chartData[state.activeTooltipIndex]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<XAxis type=\"number\" domain={[0, 100]} hide />\n\t\t\t\t\t\t<YAxis dataKey=\"week\" type=\"category\" width={isMobile ? 50 : 75} tick={{ fontSize: 12 }} />\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tformatter={(value: number | undefined) => (value !== undefined ? `${Math.round(value)}%` : 'N/A')}\n\t\t\t\t\t\t\tcontentStyle={{\n\t\t\t\t\t\t\t\tbackground: 'var(--bg-card)',\n\t\t\t\t\t\t\t\tborder: '1px solid var(--border-default)',\n\t\t\t\t\t\t\t\tborderRadius: '8px',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tcursor={{ fill: 'var(--bg-inset)' }}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{allCategoryIds.map((catId) => (\n\t\t\t\t\t\t\t<Bar\n\t\t\t\t\t\t\t\tkey={catId}\n\t\t\t\t\t\t\t\tdataKey={catId}\n\t\t\t\t\t\t\t\tstackId=\"categories\"\n\t\t\t\t\t\t\t\tfill={colorMap.get(catId) || 'var(--color-neutral)'}\n\t\t\t\t\t\t\t\tname={categoryNameMap.get(catId) || catId}\n\t\t\t\t\t\t\t\tisAnimationActive={false}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{chartData.map((entry, index) => (\n\t\t\t\t\t\t\t\t\t<Cell key={`${catId}-${index}`} opacity={entry.opacity} cursor=\"pointer\" />\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</Bar>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</BarChart>\n\t\t\t\t</ResponsiveContainer>\n\t\t\t\t<p className=\"text-xs text-body\">Click a bar to see detailed category breakdown</p>\n\t\t\t</div>\n\n\t\t\t{/* Modal */}\n\t\t\t{modal.isOpen && modal.week && (\n\t\t\t\t<CategoryDetailModal\n\t\t\t\t\tweek={modal.week}\n\t\t\t\t\tcolorMap={colorMap}\n\t\t\t\t\tonClose={() => setModal({ isOpen: false, week: null })}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</>\n\t);\n}\n\ninterface CategoryDetailModalProps {\n\tweek: WeeklyData;\n\tcolorMap: Map<string, string>;\n\tonClose: () => void;\n}\n\nfunction CategoryDetailModal({ week, colorMap, onClose }: CategoryDetailModalProps) {\n\tconst sortedCategories = useMemo(() => {\n\t\treturn [...week.categories].sort((a, b) => b.count - a.count);\n\t}, [week.categories]);\n\n\treturn (\n\t\t<div className=\"fixed inset-0 bg-black/50 flex items-end z-50 sm:items-center\">\n\t\t\t<div\n\t\t\t\tclassName=\"bg-[var(--bg-elevated)] w-full sm:w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl p-6 space-y-4 max-h-96 overflow-y-auto\"\n\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t>\n\t\t\t\t<div className=\"flex justify-between items-center pb-4 border-b border-[var(--border-default)]\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 className=\"font-semibold text-heading\">Week of {formatWeekLabel(week.start)}</h3>\n\t\t\t\t\t\t<p className=\"text-sm text-body\">{week.totalCount} events</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button onClick={onClose} className=\"text-label hover:text-heading text-xl\">\n\t\t\t\t\t\t✕\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t{/* Categories list */}\n\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t{sortedCategories.map((cat) => {\n\t\t\t\t\t\tconst percentage = week.totalCount > 0 ? Math.round((cat.count / week.totalCount) * 100) : 0;\n\n\t\t\t\t\t\tconst color = colorMap.get(cat.categoryId);\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div key={cat.categoryId} className=\"space-y-2\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-3 h-3 rounded-full flex-shrink-0\"\n\t\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\t\tbackgroundColor: color,\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium truncate text-heading\">{cat.categoryName}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 ml-2 flex-shrink-0\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm text-body\">{percentage}%</span>\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-semibold text-heading\">({cat.count})</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"bg-[var(--bg-inset)] rounded h-1.5\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-full rounded transition-all\"\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\twidth: `${percentage}%`,\n\t\t\t\t\t\t\t\t\t\t\tbackgroundColor: color,\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Close on background click */}\n\t\t\t<div className=\"fixed inset-0 -z-10\" onClick={onClose} />\n\t\t</div>\n\t);\n}\n","import { useMemo } from 'react';\nimport { X } from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\nimport { LineChart, Line, ResponsiveContainer, ReferenceLine, Dot } from 'recharts';\nimport type { CategorySentiment } from '@/shared/lib/types';\n\nconst SENTIMENT_COLORS: Record<CategorySentiment, string> = {\n\tpositive: 'var(--color-success)',\n\tlimit: 'var(--color-danger)',\n\tneutral: 'var(--color-neutral)',\n};\n\ninterface GoalCardProps {\n\tcategoryName: string;\n\tsentiment: CategorySentiment;\n\tsparklineData: { week: string; count: number }[];\n\tcurrentCount: number;\n\tbaselineAvg: number;\n\tdeltaPercent: number;\n\t/** Days elapsed in the current week (1–7). Used for pace-adjusted display. */\n\tdaysElapsed: number;\n\tonRemove: () => void;\n\tonCardClick?: () => void;\n}\n\nexport default function GoalCard({\n\tcategoryName,\n\tsentiment,\n\tsparklineData,\n\tcurrentCount,\n\tbaselineAvg,\n\tdeltaPercent,\n\tdaysElapsed,\n\tonRemove,\n\tonCardClick,\n}: GoalCardProps) {\n\tconst { t } = useTranslation('stats');\n\tconst color = SENTIMENT_COLORS[sentiment];\n\n\tconst isStable = Math.abs(deltaPercent) < 0.1;\n\tconst absPercent = Math.round(Math.abs(deltaPercent) * 100);\n\n\tconst changeText = useMemo(() => {\n\t\tif (isStable) return t('goalCard.noMeaningfulChange');\n\t\tconst sign = deltaPercent > 0 ? '+' : '−';\n\t\treturn `${sign}${absPercent}%`;\n\t}, [isStable, deltaPercent, absPercent, t]);\n\n\tconst proratedBaseline = baselineAvg * (daysElapsed / 7);\n\tconst deltaEvents = useMemo(() => {\n\t\tif (isStable) return null;\n\t\tconst raw = currentCount - proratedBaseline;\n\t\tconst sign = raw >= 0 ? '+' : '−';\n\t\tconst abs = Math.abs(raw);\n\t\tconst formatted = Number.isInteger(abs) ? abs.toString() : abs.toFixed(1);\n\t\tconst unit = t('goalCard.event', { count: Math.round(abs) });\n\t\treturn `(${sign}${formatted} ${unit})`;\n\t}, [isStable, currentCount, proratedBaseline, t]);\n\n\tconst avgFormatted = Number.isInteger(baselineAvg) ? baselineAvg.toString() : baselineAvg.toFixed(1);\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"card p-4 flex flex-col justify-between relative group h-full min-h-[160px] cursor-pointer active:scale-[0.98] transition-transform\"\n\t\t\tonClick={onCardClick}\n\t\t\trole=\"button\"\n\t\t\ttabIndex={0}\n\t\t\tonKeyDown={(e) => {\n\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tonCardClick?.();\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t{/* Remove button */}\n\t\t\t<button\n\t\t\t\tonClick={(e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tonRemove();\n\t\t\t\t}}\n\t\t\t\tclassName=\"absolute top-2 right-2 p-1 text-label opacity-60 sm:opacity-0 group-hover:opacity-100 transition-opacity hover:text-[var(--color-danger)]\"\n\t\t\t\ttitle={t('goalCard.removeFromDashboard')}\n\t\t\t>\n\t\t\t\t<X className=\"w-4 h-4\" strokeWidth={2} />\n\t\t\t</button>\n\n\t\t\t{/* 1. Category name + sentiment dot */}\n\t\t\t<div className=\"flex items-center gap-1.5\">\n\t\t\t\t<div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: color }} />\n\t\t\t\t<span className=\"text-xs font-medium text-label truncate max-w-[120px]\">{categoryName}</span>\n\t\t\t</div>\n\n\t\t\t{/* 2. Current value block — explicit values */}\n\t\t\t<div className=\"mt-1.5 space-y-0\">\n\t\t\t\t<div className=\"text-sm font-semibold text-heading\">\n\t\t\t\t\t{t('goalCard.thisWeek', { count: currentCount })}\n\t\t\t\t\t{daysElapsed < 7 && (\n\t\t\t\t\t\t<span className=\"text-xs font-normal text-label\"> {t('goalCard.partialWeek', { day: daysElapsed })}</span>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"text-xs text-label\">\n\t\t\t\t\t{t('goalCard.baselineAvg', { count: Math.round(baselineAvg), avg: avgFormatted })}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* 3. Primary change metric */}\n\t\t\t<div className=\"mt-1 flex items-baseline gap-1.5\">\n\t\t\t\t<span className=\"text-lg font-bold\" style={{ color: isStable ? undefined : color }}>\n\t\t\t\t\t{changeText}\n\t\t\t\t</span>\n\t\t\t\t{deltaEvents && <span className=\"text-[10px] text-label\">{deltaEvents}</span>}\n\t\t\t\t{!isStable && daysElapsed < 7 && <span className=\"text-[10px] text-label\">{t('goalCard.vsPace')}</span>}\n\t\t\t</div>\n\n\t\t\t{/* 4. Sparkline */}\n\t\t\t<div className=\"h-12 w-full -mx-2 mt-1\">\n\t\t\t\t<ResponsiveContainer width=\"100%\" height=\"100%\">\n\t\t\t\t\t<LineChart data={sparklineData}>\n\t\t\t\t\t\t<ReferenceLine y={baselineAvg} stroke=\"var(--border-default)\" strokeDasharray=\"3 3\" strokeWidth={1} />\n\t\t\t\t\t\t<Line\n\t\t\t\t\t\t\ttype=\"monotone\"\n\t\t\t\t\t\t\tdataKey=\"count\"\n\t\t\t\t\t\t\tstroke={color}\n\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\tdot={(props: { cx?: number; cy?: number; index?: number }) => {\n\t\t\t\t\t\t\t\tconst { cx, cy, index } = props;\n\t\t\t\t\t\t\t\tif (cx == null || cy == null || index == null) return <></>;\n\t\t\t\t\t\t\t\tconst isLast = index === sparklineData.length - 1;\n\t\t\t\t\t\t\t\tif (isLast) {\n\t\t\t\t\t\t\t\t\treturn <Dot cx={cx} cy={cy} r={4} fill={color} stroke=\"var(--bg-card)\" strokeWidth={2} />;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn <Dot cx={cx} cy={cy} r={2} fill={color} stroke=\"none\" opacity={0.35} />;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tisAnimationActive={false}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</LineChart>\n\t\t\t\t</ResponsiveContainer>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { useState, useMemo } from 'react';\nimport { X } from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\nimport { useDashboardCards, useFoodCategories, useActivityCategories } from '@/shared/store/hooks';\nimport { addDashboardCard } from '@/shared/store/store';\n\ninterface AddCategoryModalProps {\n\tonClose: () => void;\n}\n\nexport default function AddCategoryModal({ onClose }: AddCategoryModalProps) {\n\tconst { t } = useTranslation('stats');\n\tconst dashboardCards = useDashboardCards();\n\tconst foodCategories = useFoodCategories();\n\tconst activityCategories = useActivityCategories();\n\tconst [search, setSearch] = useState('');\n\n\tconst addedCategoryIds = useMemo(() => {\n\t\treturn new Set(dashboardCards.map((c) => c.categoryId));\n\t}, [dashboardCards]);\n\n\tconst categories = useMemo(() => {\n\t\tconst all = [\n\t\t\t...foodCategories.map((c) => ({ ...c, type: 'food' })),\n\t\t\t...activityCategories.map((c) => ({ ...c, type: 'activity' })),\n\t\t];\n\n\t\treturn all.sort((a, b) => a.name.localeCompare(b.name));\n\t}, [foodCategories, activityCategories]);\n\n\tconst filteredCategories = useMemo(() => {\n\t\tconst term = search.toLowerCase().trim();\n\t\treturn categories.filter((c) => c.name.toLowerCase().includes(term));\n\t}, [categories, search]);\n\n\tconst handleSelect = (categoryId: string) => {\n\t\tif (addedCategoryIds.has(categoryId)) return;\n\t\taddDashboardCard(categoryId);\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\n\t\t\t<div\n\t\t\t\tclassName=\"card w-full max-w-md bg-elevated shadow-elevated flex flex-col max-h-[80vh]\"\n\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t>\n\t\t\t\t<div className=\"p-4 border-b flex items-center justify-between\">\n\t\t\t\t\t<h3 className=\"text-lg font-bold\">{t('addCategoryModal.title')}</h3>\n\t\t\t\t\t<button onClick={onClose} className=\"p-1 hover:bg-inset rounded-full transition-colors\">\n\t\t\t\t\t\t<X className=\"w-5 h-5\" strokeWidth={2} />\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"p-4\">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder={t('addCategoryModal.searchPlaceholder')}\n\t\t\t\t\t\tclassName=\"form-input\"\n\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\tonChange={(e) => setSearch(e.target.value)}\n\t\t\t\t\t\tautoFocus\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"flex-1 overflow-y-auto p-2 space-y-1\">\n\t\t\t\t\t{filteredCategories.map((category) => {\n\t\t\t\t\t\tconst isAdded = addedCategoryIds.has(category.id);\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tkey={category.id}\n\t\t\t\t\t\t\t\tonClick={() => handleSelect(category.id)}\n\t\t\t\t\t\t\t\tdisabled={isAdded}\n\t\t\t\t\t\t\t\tclassName={`w-full text-left px-3 py-2 rounded-md flex items-center justify-between transition-colors ${\n\t\t\t\t\t\t\t\t\tisAdded ? 'opacity-50 cursor-not-allowed bg-inset' : 'hover:bg-inset'\n\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-2 h-2 rounded-full\"\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\tbackgroundColor: category.type === 'food' ? 'var(--color-food)' : 'var(--color-activity)',\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{category.name}</span>\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-label px-1.5 py-0.5 rounded-full bg-inset capitalize\">\n\t\t\t\t\t\t\t\t\t\t{category.type}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{isAdded && <span className=\"text-xs font-medium text-label\">{t('addCategoryModal.added')}</span>}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\n\t\t\t\t\t{filteredCategories.length === 0 && (\n\t\t\t\t\t\t<div className=\"py-8 text-center text-label\">{t('addCategoryModal.noResults', { search })}</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"fixed inset-0 -z-10\" onClick={onClose} />\n\t\t</div>\n\t);\n}\n","import { useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { useTrackerData } from '@/shared/store/hooks';\nimport { getLastNWeeks, getDaysElapsedInCurrentWeek } from '../utils/stats-engine';\nimport { filterEntriesByCategory, filterEntriesByDateRange } from '@/features/tracking';\nimport { formatDateLocal } from '@/shared/lib/date-utils';\nimport GoalCard from './GoalCard';\nimport { removeDashboardCard } from '@/shared/store/store';\nimport AddCategoryModal from './AddCategoryModal';\n\nexport default function GoalDashboard() {\n\tconst { t } = useTranslation('stats');\n\tconst navigate = useNavigate();\n\tconst data = useTrackerData();\n\tconst [isModalOpen, setIsModalOpen] = useState(false);\n\n\t// Recalculate week boundaries when entries change (new entries may span a new week)\n\tconst weeks = useMemo(() => getLastNWeeks(8), [data.entries]);\n\n\t// How many days have elapsed in the current (partial) week\n\tconst currentWeek = weeks[weeks.length - 1];\n\tconst daysElapsed = currentWeek ? getDaysElapsedInCurrentWeek(currentWeek.start) : 7;\n\n\tconst dashboardData = useMemo(() => {\n\t\tif (!data.dashboardCards) return [];\n\n\t\treturn data.dashboardCards\n\t\t\t.map((card) => {\n\t\t\t\tconst categoryId = card.categoryId;\n\n\t\t\t\t// Find category and determine color/type/sentiment\n\t\t\t\tconst foodCat = data.foodCategories.find((c) => c.id === categoryId);\n\t\t\t\tconst activityCat = data.activityCategories.find((c) => c.id === categoryId);\n\t\t\t\tconst category = foodCat || activityCat;\n\n\t\t\t\tif (!category) return null;\n\n\t\t\t\tconst categoryName = category.name;\n\t\t\t\tconst sentiment = category.sentiment;\n\n\t\t\t\t// Calculate weekly counts\n\t\t\t\tconst sparklineData = weeks.map((week) => {\n\t\t\t\t\tconst range = {\n\t\t\t\t\t\tstart: formatDateLocal(week.start),\n\t\t\t\t\t\tend: formatDateLocal(week.end),\n\t\t\t\t\t};\n\t\t\t\t\tconst weekEntries = filterEntriesByCategory(filterEntriesByDateRange(data.entries, range), categoryId, data);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tweek: week.key,\n\t\t\t\t\t\tcount: weekEntries.length,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\t// Current week (last element)\n\t\t\t\tconst currentCount = sparklineData[sparklineData.length - 1].count;\n\n\t\t\t\t// Baseline: average of the 4 weeks preceding the last week\n\t\t\t\tconst baselineWeeks = sparklineData.slice(3, 7);\n\t\t\t\tconst baselineSum = baselineWeeks.reduce((sum, w) => sum + w.count, 0);\n\t\t\t\tconst baselineAvg = baselineSum / 4;\n\n\t\t\t\t// Pro-rate: scale baseline down to match elapsed days so partial weeks\n\t\t\t\t// are compared fairly (e.g. day 1 compares against 1/7 of the avg)\n\t\t\t\tconst proratedBaseline = baselineAvg * (daysElapsed / 7);\n\t\t\t\tconst delta = currentCount - proratedBaseline;\n\t\t\t\tconst deltaPercent = proratedBaseline === 0 ? (currentCount > 0 ? 1 : 0) : delta / proratedBaseline;\n\n\t\t\t\treturn {\n\t\t\t\t\tcategoryId,\n\t\t\t\t\tcategoryName,\n\t\t\t\t\tsentiment,\n\t\t\t\t\tsparklineData,\n\t\t\t\t\tcurrentCount,\n\t\t\t\t\tbaselineAvg,\n\t\t\t\t\tdeltaPercent,\n\t\t\t\t\tdaysElapsed,\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter((item): item is NonNullable<typeof item> => item !== null);\n\t}, [data, weeks, daysElapsed]);\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<h2 className=\"text-xl font-bold text-heading\">{t('goalDashboard.title')}</h2>\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => setIsModalOpen(true)}\n\t\t\t\t\tclassName=\"text-sm font-medium transition-colors hover:opacity-80\"\n\t\t\t\t\tstyle={{ color: 'var(--color-activity)' }}\n\t\t\t\t>\n\t\t\t\t\t{t('goalDashboard.addToDashboard')}\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclassName=\"grid grid-cols-1 sm:grid-cols-2 gap-4 overflow-y-auto pr-1\"\n\t\t\t\tstyle={{ maxHeight: 'calc(3 * 180px + 2 * 1rem)' }}\n\t\t\t>\n\t\t\t\t{dashboardData.map((card) => (\n\t\t\t\t\t<GoalCard\n\t\t\t\t\t\tkey={card.categoryId}\n\t\t\t\t\t\tcategoryName={card.categoryName}\n\t\t\t\t\t\tsentiment={card.sentiment}\n\t\t\t\t\t\tsparklineData={card.sparklineData}\n\t\t\t\t\t\tcurrentCount={card.currentCount}\n\t\t\t\t\t\tbaselineAvg={card.baselineAvg}\n\t\t\t\t\t\tdeltaPercent={card.deltaPercent}\n\t\t\t\t\t\tdaysElapsed={card.daysElapsed}\n\t\t\t\t\t\tonRemove={() => removeDashboardCard(card.categoryId)}\n\t\t\t\t\t\tonCardClick={() => navigate(`/stats/category/${card.categoryId}`)}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\n\t\t\t\t{dashboardData.length === 0 && (\n\t\t\t\t\t<div className=\"col-span-full py-8 text-center card bg-inset border-dashed\">\n\t\t\t\t\t\t<p className=\"text-label text-sm\">{t('goalDashboard.noDashboardCards')}</p>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={() => setIsModalOpen(true)}\n\t\t\t\t\t\t\tclassName=\"mt-2 text-sm font-semibold\"\n\t\t\t\t\t\t\tstyle={{ color: 'var(--color-activity)' }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{t('goalDashboard.addFirstCategory')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{isModalOpen && <AddCategoryModal onClose={() => setIsModalOpen(false)} />}\n\t\t</div>\n\t);\n}\n","import { useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport type { TrackerData, EntryType, Entry } from '@/shared/lib/types';\nimport { getTodayDate } from '@/shared/lib/types';\nimport { filterEntriesByType, filterEntriesByDateRange, getEntryCategoryIds } from '@/features/tracking';\nimport { getDateNDaysAgo } from '@/shared/lib/date-utils';\nimport { cn } from '@/shared/lib/cn';\nimport SegmentedControl from '@/shared/ui/SegmentedControl';\n\ntype TimePeriod = 'all' | '7d' | '30d';\ntype TypeFilter = 'all' | 'activity' | 'food';\ntype ViewMode = 'items' | 'categories';\n\ninterface RankedRow {\n\tid: string;\n\tname: string;\n\tcount: number;\n\ttype: EntryType;\n}\n\nfunction rankItems(entries: Entry[], data: TrackerData): RankedRow[] {\n\tconst itemLookup = new Map([...data.activityItems, ...data.foodItems].map((item) => [item.id, item]));\n\tconst counts = new Map<string, RankedRow>();\n\n\tfor (const entry of entries) {\n\t\tconst existing = counts.get(entry.itemId);\n\t\tif (existing) {\n\t\t\texisting.count++;\n\t\t} else {\n\t\t\tconst item = itemLookup.get(entry.itemId);\n\t\t\tcounts.set(entry.itemId, {\n\t\t\t\tid: entry.itemId,\n\t\t\t\tname: item?.name ?? 'Unknown',\n\t\t\t\tcount: 1,\n\t\t\t\ttype: entry.type,\n\t\t\t});\n\t\t}\n\t}\n\n\treturn Array.from(counts.values()).sort((a, b) => b.count - a.count);\n}\n\nfunction rankCategories(entries: Entry[], data: TrackerData): RankedRow[] {\n\tconst catLookup = new Map([...data.activityCategories, ...data.foodCategories].map((cat) => [cat.id, cat]));\n\tconst counts = new Map<string, RankedRow>();\n\n\tfor (const entry of entries) {\n\t\tconst catIds = getEntryCategoryIds(entry, data);\n\t\tfor (const catId of catIds) {\n\t\t\tconst existing = counts.get(catId);\n\t\t\tif (existing) {\n\t\t\t\texisting.count++;\n\t\t\t} else {\n\t\t\t\tconst cat = catLookup.get(catId);\n\t\t\t\tcounts.set(catId, {\n\t\t\t\t\tid: catId,\n\t\t\t\t\tname: cat?.name ?? 'Unknown',\n\t\t\t\t\tcount: 1,\n\t\t\t\t\ttype: entry.type,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Array.from(counts.values()).sort((a, b) => b.count - a.count);\n}\n\ninterface Props {\n\tentries: Entry[];\n\tdata: TrackerData;\n}\n\nexport default function FrequencyRanking({ entries, data }: Props) {\n\tconst { t } = useTranslation('stats');\n\tconst [timePeriod, setTimePeriod] = useState<TimePeriod>('all');\n\tconst [typeFilter, setTypeFilter] = useState<TypeFilter>('all');\n\tconst [viewMode, setViewMode] = useState<ViewMode>('items');\n\n\tconst timeFilteredEntries = useMemo(() => {\n\t\tif (timePeriod === 'all') return entries;\n\t\tconst days = timePeriod === '7d' ? 7 : 30;\n\t\treturn filterEntriesByDateRange(entries, {\n\t\t\tstart: getDateNDaysAgo(days - 1),\n\t\t\tend: getTodayDate(),\n\t\t});\n\t}, [entries, timePeriod]);\n\n\tconst filteredEntries = useMemo(() => {\n\t\tif (typeFilter === 'all') return timeFilteredEntries;\n\t\treturn filterEntriesByType(timeFilteredEntries, typeFilter);\n\t}, [timeFilteredEntries, typeFilter]);\n\n\tconst ranked = useMemo(() => {\n\t\tif (viewMode === 'items') {\n\t\t\treturn rankItems(filteredEntries, data);\n\t\t}\n\t\treturn rankCategories(filteredEntries, data);\n\t}, [filteredEntries, data, viewMode]);\n\n\tconst maxCount = ranked.length > 0 ? ranked[0].count : 0;\n\n\treturn (\n\t\t<div className=\"space-y-3\">\n\t\t\t<h2 className=\"text-lg font-semibold text-heading\">{t('frequencyRanking.title')}</h2>\n\n\t\t\t<SegmentedControl\n\t\t\t\toptions={[\n\t\t\t\t\t{ value: 'all' as const, label: t('frequencyRanking.timePeriod.all') },\n\t\t\t\t\t{ value: '7d' as const, label: t('frequencyRanking.timePeriod.7d') },\n\t\t\t\t\t{ value: '30d' as const, label: t('frequencyRanking.timePeriod.30d') },\n\t\t\t\t]}\n\t\t\t\tvalue={timePeriod}\n\t\t\t\tonChange={setTimePeriod}\n\t\t\t\tvariant=\"segment\"\n\t\t\t\tsize=\"sm\"\n\t\t\t/>\n\n\t\t\t<SegmentedControl\n\t\t\t\toptions={[\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'all' as const,\n\t\t\t\t\t\tlabel: t('frequencyRanking.typeFilter.all'),\n\t\t\t\t\t\tactiveClass: 'bg-[var(--text-secondary)] text-white',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'activity' as const,\n\t\t\t\t\t\tlabel: t('frequencyRanking.typeFilter.activities'),\n\t\t\t\t\t\tactiveClass: 'type-activity',\n\t\t\t\t\t},\n\t\t\t\t\t{ value: 'food' as const, label: t('frequencyRanking.typeFilter.food'), activeClass: 'type-food' },\n\t\t\t\t]}\n\t\t\t\tvalue={typeFilter}\n\t\t\t\tonChange={setTypeFilter}\n\t\t\t\tvariant=\"segment\"\n\t\t\t\tsize=\"sm\"\n\t\t\t/>\n\n\t\t\t<SegmentedControl\n\t\t\t\toptions={[\n\t\t\t\t\t{ value: 'items' as const, label: t('frequencyRanking.viewMode.items') },\n\t\t\t\t\t{ value: 'categories' as const, label: t('frequencyRanking.viewMode.categories') },\n\t\t\t\t]}\n\t\t\t\tvalue={viewMode}\n\t\t\t\tonChange={setViewMode}\n\t\t\t\tvariant=\"segment\"\n\t\t\t\tsize=\"sm\"\n\t\t\t/>\n\n\t\t\t{ranked.length === 0 ? (\n\t\t\t\t<p className=\"text-sm text-label text-center py-4\">\n\t\t\t\t\t{t('frequencyRanking.empty', { viewMode: t(`frequencyRanking.viewMode.${viewMode}`).toLowerCase() })}\n\t\t\t\t</p>\n\t\t\t) : (\n\t\t\t\t<div className=\"space-y-1.5\">\n\t\t\t\t\t{ranked.map((row, i) => (\n\t\t\t\t\t\t<div key={row.id} className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t<span className=\"text-xs text-muted w-5 text-right shrink-0\">{i + 1}</span>\n\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2 mb-0.5\">\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm text-heading truncate\">{row.name}</span>\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-label shrink-0\">{row.count}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"h-1 rounded-full bg-[var(--bg-inset)] overflow-hidden\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t'h-full rounded-full transition-all',\n\t\t\t\t\t\t\t\t\t\t\trow.type === 'activity' ? 'bg-[var(--color-activity)]' : 'bg-[var(--color-food)]',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\tstyle={{ width: `${(row.count / maxCount) * 100}%` }}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","import { useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useTrackerData } from '@/shared/store/hooks';\nimport BalanceOverview from './BalanceOverview';\nimport ActionableCategories from './ActionableCategories';\nimport CategoryComposition from './CategoryComposition';\nimport GoalDashboard from './GoalDashboard';\nimport FrequencyRanking from './FrequencyRanking';\nimport SegmentedControl from '@/shared/ui/SegmentedControl';\nimport { getLastNWeeks, processFoodEntriesByWeek } from '../utils/stats-engine';\n\ntype PeriodType = 'weekly' | 'monthly';\n\nexport default function StatsPage() {\n\tconst { t } = useTranslation('stats');\n\tconst data = useTrackerData();\n\tconst [period, setPeriod] = useState<PeriodType>('weekly');\n\n\tconst weeks = useMemo(() => getLastNWeeks(8), []);\n\n\tconst weeklyData = useMemo(() => {\n\t\treturn processFoodEntriesByWeek(data.entries, data, weeks);\n\t}, [data, weeks]);\n\n\tconst hasData = useMemo(() => {\n\t\treturn weeklyData.some((w) => w.totalCount > 0);\n\t}, [weeklyData]);\n\n\treturn (\n\t\t<div className=\"space-y-4 sm:space-y-6 pb-6\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"space-y-2\">\n\t\t\t\t<h1 className=\"text-2xl font-bold\">{t('title')}</h1>\n\t\t\t\t<p className=\"text-body\">{t('subtitle')}</p>\n\t\t\t</div>\n\n\t\t\t{/* Period toggle */}\n\t\t\t<SegmentedControl\n\t\t\t\toptions={[\n\t\t\t\t\t{ value: 'weekly' as const, label: t('period.weekly') },\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: 'monthly' as const,\n\t\t\t\t\t\tlabel: t('period.monthly'),\n\t\t\t\t\t\tdisabled: true,\n\t\t\t\t\t\ttitle: t('period.monthlyComingSoon'),\n\t\t\t\t\t},\n\t\t\t\t]}\n\t\t\t\tvalue={period}\n\t\t\t\tonChange={setPeriod}\n\t\t\t\tvariant=\"segment\"\n\t\t\t\tsize=\"sm\"\n\t\t\t/>\n\n\t\t\t{/* Empty state */}\n\t\t\t{!hasData && (\n\t\t\t\t<div className=\"card p-8 text-center space-y-2\">\n\t\t\t\t\t<p className=\"text-body\">{t('empty.noFoodEntries')}</p>\n\t\t\t\t\t<p className=\"text-sm text-label\">{t('empty.startLogging')}</p>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Content */}\n\t\t\t{hasData && (\n\t\t\t\t<>\n\t\t\t\t\t{/* Section 0: Goal Dashboard */}\n\t\t\t\t\t<GoalDashboard />\n\n\t\t\t\t\t<hr className=\"border-[var(--border-default)]\" />\n\n\t\t\t\t\t{/* Section 1: Balance Overview */}\n\t\t\t\t\t<BalanceOverview weeklyData={weeklyData} />\n\n\t\t\t\t\t{/* Section 1.5: Actionable Categories (Focus Areas) */}\n\t\t\t\t\t<ActionableCategories data={data} />\n\n\t\t\t\t\t{/* Section 2: Category Composition */}\n\t\t\t\t\t<CategoryComposition weeklyData={weeklyData} />\n\t\t\t\t</>\n\t\t\t)}\n\n\t\t\t{/* Frequency Ranking — shows for any entries */}\n\t\t\t{data.entries.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t<hr className=\"border-[var(--border-default)]\" />\n\t\t\t\t\t<FrequencyRanking entries={data.entries} data={data} />\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","import { useTranslation } from 'react-i18next';\nimport { BarChart, Bar, XAxis, ResponsiveContainer, Cell } from 'recharts';\nimport type { CategorySentiment } from '@/shared/lib/types';\n\nconst SENTIMENT_COLORS: Record<CategorySentiment, string> = {\n\tpositive: 'var(--color-success)',\n\tlimit: 'var(--color-danger)',\n\tneutral: 'var(--color-neutral)',\n};\n\ninterface WeekBreakdownTooltipProps {\n\tweekNumber: number;\n\ttotal: number;\n\tdailyData: Array<{ day: string; count: number }>;\n\tsentiment: CategorySentiment;\n}\n\nexport default function WeekBreakdownTooltip({ weekNumber, total, dailyData, sentiment }: WeekBreakdownTooltipProps) {\n\tconst { t } = useTranslation('stats');\n\tconst color = SENTIMENT_COLORS[sentiment];\n\tconst maxCount = Math.max(...dailyData.map((d) => d.count), 1);\n\n\treturn (\n\t\t<div className=\"card p-3 space-y-2 shadow-[var(--shadow-elevated)]\">\n\t\t\t<div className=\"flex items-center justify-between gap-4\">\n\t\t\t\t<span className=\"text-sm font-semibold text-heading\">\n\t\t\t\t\t{t('categoryDetail.weekBreakdownTitle', { week: weekNumber })}\n\t\t\t\t</span>\n\t\t\t\t<span className=\"text-xs text-label\">{t('categoryDetail.weekBreakdownTotal', { count: total })}</span>\n\t\t\t</div>\n\t\t\t<div className=\"h-20\">\n\t\t\t\t<ResponsiveContainer width=\"100%\" height=\"100%\">\n\t\t\t\t\t<BarChart data={dailyData} margin={{ top: 4, right: 0, left: 0, bottom: 0 }}>\n\t\t\t\t\t\t<XAxis\n\t\t\t\t\t\t\tdataKey=\"day\"\n\t\t\t\t\t\t\ttickLine={false}\n\t\t\t\t\t\t\taxisLine={false}\n\t\t\t\t\t\t\ttick={{ fontSize: 11, fill: 'var(--text-tertiary)' }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Bar dataKey=\"count\" radius={[3, 3, 0, 0]} isAnimationActive={false}>\n\t\t\t\t\t\t\t{dailyData.map((entry, index) => (\n\t\t\t\t\t\t\t\t<Cell\n\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\tfill={entry.count > 0 ? color : 'var(--bg-inset)'}\n\t\t\t\t\t\t\t\t\topacity={entry.count > 0 ? 0.4 + (entry.count / maxCount) * 0.6 : 0.3}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</Bar>\n\t\t\t\t\t</BarChart>\n\t\t\t\t</ResponsiveContainer>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","import { useMemo } from 'react';\nimport { LineChart, Line, XAxis, YAxis, ResponsiveContainer, ReferenceLine, Dot } from 'recharts';\nimport type { CategorySentiment } from '@/shared/lib/types';\nimport type { Entry } from '@/shared/lib/types';\nimport { formatWeekLabel, getWeekNumber, getDailyBreakdown } from '../utils/stats-engine';\nimport WeekBreakdownTooltip from './WeekBreakdownTooltip';\n\nconst SENTIMENT_COLORS: Record<CategorySentiment, string> = {\n\tpositive: 'var(--color-success)',\n\tlimit: 'var(--color-danger)',\n\tneutral: 'var(--color-neutral)',\n};\n\ninterface ChartWeek {\n\tlabel: string;\n\tcount: number;\n\tweekKey: string;\n\tstart: Date;\n\tend: Date;\n\tentries: Entry[];\n}\n\ninterface CategoryTrendChartProps {\n\tweeks: ChartWeek[];\n\tbaselineAvg: number;\n\tsentiment: CategorySentiment;\n\tselectedWeekIndex: number | null;\n\tonSelectWeek: (index: number | null) => void;\n}\n\nexport default function CategoryTrendChart({\n\tweeks,\n\tbaselineAvg,\n\tsentiment,\n\tselectedWeekIndex,\n\tonSelectWeek,\n}: CategoryTrendChartProps) {\n\tconst color = SENTIMENT_COLORS[sentiment];\n\n\tconst chartData = useMemo(\n\t\t() =>\n\t\t\tweeks.map((w) => ({\n\t\t\t\tlabel: formatWeekLabel(w.start),\n\t\t\t\tcount: w.count,\n\t\t\t})),\n\t\t[weeks],\n\t);\n\n\tconst maxCount = useMemo(() => Math.max(...weeks.map((w) => w.count), baselineAvg, 1), [weeks, baselineAvg]);\n\n\tconst tooltipData = useMemo(() => {\n\t\tif (selectedWeekIndex === null || !weeks[selectedWeekIndex]) return null;\n\t\tconst week = weeks[selectedWeekIndex];\n\t\treturn {\n\t\t\tweekNumber: getWeekNumber(week.weekKey),\n\t\t\ttotal: week.count,\n\t\t\tdailyData: getDailyBreakdown(week.entries, week.start, week.end),\n\t\t};\n\t}, [selectedWeekIndex, weeks]);\n\n\treturn (\n\t\t<div className=\"space-y-2\">\n\t\t\t{/* Line chart */}\n\t\t\t<div className=\"h-48 w-full -mx-2\">\n\t\t\t\t<ResponsiveContainer width=\"100%\" height=\"100%\">\n\t\t\t\t\t<LineChart\n\t\t\t\t\t\tdata={chartData}\n\t\t\t\t\t\tmargin={{ top: 24, right: 16, left: 8, bottom: 4 }}\n\t\t\t\t\t\tonClick={(state) => {\n\t\t\t\t\t\t\tconst idx = typeof state?.activeTooltipIndex === 'number' ? state.activeTooltipIndex : null;\n\t\t\t\t\t\t\tif (idx !== null) {\n\t\t\t\t\t\t\t\tonSelectWeek(idx === selectedWeekIndex ? null : idx);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<XAxis\n\t\t\t\t\t\t\tdataKey=\"label\"\n\t\t\t\t\t\t\ttickLine={false}\n\t\t\t\t\t\t\taxisLine={false}\n\t\t\t\t\t\t\ttick={{ fontSize: 11, fill: 'var(--text-tertiary)' }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<YAxis hide domain={[0, Math.ceil(maxCount * 1.2)]} />\n\t\t\t\t\t\t<ReferenceLine y={baselineAvg} stroke=\"var(--border-default)\" strokeDasharray=\"4 4\" strokeWidth={1} />\n\t\t\t\t\t\t<Line\n\t\t\t\t\t\t\ttype=\"monotone\"\n\t\t\t\t\t\t\tdataKey=\"count\"\n\t\t\t\t\t\t\tstroke={color}\n\t\t\t\t\t\t\tstrokeWidth={2.5}\n\t\t\t\t\t\t\tisAnimationActive={false}\n\t\t\t\t\t\t\tdot={(props: { cx?: number; cy?: number; index?: number; payload?: { count: number } }) => {\n\t\t\t\t\t\t\t\tconst { cx, cy, index, payload } = props;\n\t\t\t\t\t\t\t\tif (cx == null || cy == null || index == null) return <g />;\n\t\t\t\t\t\t\t\tconst isSelected = index === selectedWeekIndex;\n\t\t\t\t\t\t\t\tconst isLast = index === weeks.length - 1;\n\t\t\t\t\t\t\t\tconst r = isSelected || isLast ? 5 : 3;\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<g>\n\t\t\t\t\t\t\t\t\t\t<Dot\n\t\t\t\t\t\t\t\t\t\t\tcx={cx}\n\t\t\t\t\t\t\t\t\t\t\tcy={cy}\n\t\t\t\t\t\t\t\t\t\t\tr={r}\n\t\t\t\t\t\t\t\t\t\t\tfill={isSelected || isLast ? color : 'var(--bg-card)'}\n\t\t\t\t\t\t\t\t\t\t\tstroke={color}\n\t\t\t\t\t\t\t\t\t\t\tstrokeWidth={2}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/* Value label above dot */}\n\t\t\t\t\t\t\t\t\t\t<text\n\t\t\t\t\t\t\t\t\t\t\tx={cx}\n\t\t\t\t\t\t\t\t\t\t\ty={cy - 12}\n\t\t\t\t\t\t\t\t\t\t\ttextAnchor=\"middle\"\n\t\t\t\t\t\t\t\t\t\t\tfontSize={11}\n\t\t\t\t\t\t\t\t\t\t\tfontWeight={600}\n\t\t\t\t\t\t\t\t\t\t\tfill=\"var(--text-secondary)\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{payload?.count}\n\t\t\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tactiveDot={false}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</LineChart>\n\t\t\t\t</ResponsiveContainer>\n\t\t\t</div>\n\n\t\t\t{/* Tooltip overlay */}\n\t\t\t{tooltipData && (\n\t\t\t\t<WeekBreakdownTooltip\n\t\t\t\t\tweekNumber={tooltipData.weekNumber}\n\t\t\t\t\ttotal={tooltipData.total}\n\t\t\t\t\tdailyData={tooltipData.dailyData}\n\t\t\t\t\tsentiment={sentiment}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","import { useTranslation } from 'react-i18next';\nimport type { CategorySentiment } from '@/shared/lib/types';\nimport { cn } from '@/shared/lib/cn';\n\nconst SENTIMENT_COLORS: Record<CategorySentiment, string> = {\n\tpositive: 'var(--color-success)',\n\tlimit: 'var(--color-danger)',\n\tneutral: 'var(--color-neutral)',\n};\n\ninterface WeekData {\n\tweekNumber: number;\n\tcount: number;\n\tpercentChange: number | null;\n}\n\ninterface WeekHistoryGridProps {\n\tweeks: WeekData[];\n\tcurrentWeekIndex: number;\n\tselectedWeekIndex: number | null;\n\tsentiment: CategorySentiment;\n\tonSelectWeek: (index: number) => void;\n}\n\nexport default function WeekHistoryGrid({\n\tweeks,\n\tcurrentWeekIndex,\n\tselectedWeekIndex,\n\tsentiment,\n\tonSelectWeek,\n}: WeekHistoryGridProps) {\n\tconst { t } = useTranslation('stats');\n\tconst color = SENTIMENT_COLORS[sentiment];\n\n\treturn (\n\t\t<div className=\"space-y-3\">\n\t\t\t<h3 className=\"text-sm font-semibold text-heading\">{t('categoryDetail.last8Weeks')}</h3>\n\t\t\t<div className=\"grid grid-cols-2 gap-2\">\n\t\t\t\t{weeks.map((week, index) => {\n\t\t\t\t\tconst isCurrentWeek = index === currentWeekIndex;\n\t\t\t\t\tconst isSelected = index === selectedWeekIndex;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tkey={week.weekNumber}\n\t\t\t\t\t\t\tonClick={() => onSelectWeek(index)}\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t'card p-3 flex items-center justify-between text-left transition-all',\n\t\t\t\t\t\t\t\tisSelected && 'ring-1',\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tborderLeftWidth: isCurrentWeek ? '3px' : undefined,\n\t\t\t\t\t\t\t\t\tborderLeftColor: isCurrentWeek ? color : undefined,\n\t\t\t\t\t\t\t\t\t'--tw-ring-color': isSelected ? color : undefined,\n\t\t\t\t\t\t\t\t} as React.CSSProperties\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"text-xs font-semibold text-heading\">\n\t\t\t\t\t\t\t\t\t{t('categoryDetail.weekLabel', { week: week.weekNumber })}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"text-lg font-bold text-heading\">{week.count}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"text-xs font-medium\" style={{ color: getChangeColor(week.percentChange, sentiment) }}>\n\t\t\t\t\t\t\t\t{formatChange(week.percentChange)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction getChangeColor(percentChange: number | null, sentiment: CategorySentiment): string {\n\tif (percentChange === null || percentChange === 0) return 'var(--text-muted)';\n\t// For limit categories: increase is bad (danger), decrease is good (success)\n\t// For positive categories: increase is good (success), decrease is bad (danger)\n\t// For neutral: just use muted\n\tif (sentiment === 'neutral') return 'var(--text-secondary)';\n\tconst increaseIsBad = sentiment === 'limit';\n\tif (percentChange > 0) return increaseIsBad ? 'var(--color-danger)' : 'var(--color-success)';\n\treturn increaseIsBad ? 'var(--color-success)' : 'var(--color-danger)';\n}\n\nfunction formatChange(percentChange: number | null): string {\n\tif (percentChange === null) return '--';\n\tif (percentChange === 0) return '0%';\n\tconst sign = percentChange > 0 ? '+' : '';\n\treturn `${sign}${Math.round(percentChange)}%`;\n}\n","import { useMemo, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { X } from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\nimport { useTrackerData } from '@/shared/store/hooks';\nimport { formatDateLocal } from '@/shared/lib/date-utils';\nimport type { CategorySentiment } from '@/shared/lib/types';\nimport { filterEntriesByCategory, filterEntriesByDateRange } from '@/features/tracking';\nimport { getLastNWeeks, getDaysElapsedInCurrentWeek, getWeekNumber } from '../utils/stats-engine';\nimport CategoryTrendChart from './CategoryTrendChart';\nimport WeekHistoryGrid from './WeekHistoryGrid';\n\nconst SENTIMENT_COLORS: Record<CategorySentiment, string> = {\n\tpositive: 'var(--color-success)',\n\tlimit: 'var(--color-danger)',\n\tneutral: 'var(--color-neutral)',\n};\n\nexport default function CategoryDetailPage() {\n\tconst { categoryId } = useParams<{ categoryId: string }>();\n\tconst navigate = useNavigate();\n\tconst { t } = useTranslation('stats');\n\tconst data = useTrackerData();\n\tconst [selectedWeekIndex, setSelectedWeekIndex] = useState<number | null>(null);\n\n\tconst weeks = useMemo(() => getLastNWeeks(8), [data.entries]);\n\tconst currentWeek = weeks[weeks.length - 1];\n\tconst daysElapsed = currentWeek ? getDaysElapsedInCurrentWeek(currentWeek.start) : 7;\n\n\t// Find the category across food and activity\n\tconst category = useMemo(() => {\n\t\treturn (\n\t\t\tdata.foodCategories.find((c) => c.id === categoryId) || data.activityCategories.find((c) => c.id === categoryId)\n\t\t);\n\t}, [data.foodCategories, data.activityCategories, categoryId]);\n\n\t// Calculate weekly data for this category\n\tconst weeklyStats = useMemo(() => {\n\t\tif (!categoryId) return [];\n\t\treturn weeks.map((week) => {\n\t\t\tconst range = { start: formatDateLocal(week.start), end: formatDateLocal(week.end) };\n\t\t\tconst weekEntries = filterEntriesByCategory(filterEntriesByDateRange(data.entries, range), categoryId, data);\n\t\t\treturn {\n\t\t\t\tweekKey: week.key,\n\t\t\t\tlabel: week.key,\n\t\t\t\tcount: weekEntries.length,\n\t\t\t\tstart: week.start,\n\t\t\t\tend: week.end,\n\t\t\t\tentries: weekEntries,\n\t\t\t};\n\t\t});\n\t}, [weeks, categoryId, data]);\n\n\t// Baseline: average of weeks at indices 3–6 (the 4 weeks before the current week)\n\tconst baselineAvg = useMemo(() => {\n\t\tconst baselineWeeks = weeklyStats.slice(3, 7);\n\t\tconst sum = baselineWeeks.reduce((s, w) => s + w.count, 0);\n\t\treturn sum / 4;\n\t}, [weeklyStats]);\n\n\t// Current week stats\n\tconst currentCount = weeklyStats.length > 0 ? weeklyStats[weeklyStats.length - 1].count : 0;\n\tconst proratedBaseline = baselineAvg * (daysElapsed / 7);\n\tconst delta = currentCount - proratedBaseline;\n\tconst deltaPercent = proratedBaseline === 0 ? (currentCount > 0 ? 1 : 0) : delta / proratedBaseline;\n\tconst isStable = Math.abs(deltaPercent) < 0.1;\n\n\tconst sentiment = category?.sentiment ?? 'neutral';\n\tconst color = SENTIMENT_COLORS[sentiment];\n\n\t// Week history data (week number, count, % change from previous)\n\tconst weekHistoryData = useMemo(() => {\n\t\treturn weeklyStats.map((week, i) => {\n\t\t\tconst prev = i > 0 ? weeklyStats[i - 1].count : null;\n\t\t\tconst percentChange =\n\t\t\t\tprev === null ? null : prev === 0 ? (week.count > 0 ? 100 : 0) : ((week.count - prev) / prev) * 100;\n\t\t\treturn {\n\t\t\t\tweekNumber: getWeekNumber(week.weekKey),\n\t\t\t\tcount: week.count,\n\t\t\t\tpercentChange,\n\t\t\t};\n\t\t});\n\t}, [weeklyStats]);\n\n\tif (!category) {\n\t\treturn (\n\t\t\t<div className=\"flex flex-col items-center justify-center py-24 gap-4\">\n\t\t\t\t<p className=\"text-label\">{t('categoryDetail.notFound')}</p>\n\t\t\t\t<button onClick={() => navigate('/stats')} className=\"btn btn-secondary btn-sm\">\n\t\t\t\t\t{t('categoryDetail.goBack')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tconst avgFormatted = Number.isInteger(baselineAvg) ? baselineAvg.toString() : baselineAvg.toFixed(1);\n\tconst absPercent = Math.round(Math.abs(deltaPercent) * 100);\n\tconst changeSign = deltaPercent > 0 ? '+' : '\\u2212';\n\tconst changeText = isStable ? '' : `${changeSign}${absPercent}%`;\n\tconst deltaRaw = Math.abs(delta);\n\tconst deltaFormatted = Number.isInteger(deltaRaw) ? deltaRaw.toString() : deltaRaw.toFixed(1);\n\tconst deltaUnit = t('categoryDetail.event', { count: Math.round(deltaRaw) });\n\tconst deltaEventsText = isStable ? null : `(${changeSign}${deltaFormatted} ${deltaUnit})`;\n\n\treturn (\n\t\t<div className=\"space-y-6 pb-4\">\n\t\t\t{/* Header */}\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<div className=\"flex items-center gap-2\">\n\t\t\t\t\t<div className=\"w-2.5 h-2.5 rounded-full\" style={{ backgroundColor: color }} />\n\t\t\t\t\t<h1 className=\"text-xl font-bold text-heading\">{category.name}</h1>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => navigate('/stats')}\n\t\t\t\t\tclassName=\"p-2 -mr-2 text-label hover:text-heading transition-colors\"\n\t\t\t\t>\n\t\t\t\t\t<X className=\"w-5 h-5\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t{/* Summary stats */}\n\t\t\t<div className=\"card p-4 space-y-1\">\n\t\t\t\t<div className=\"text-sm font-semibold text-heading\">\n\t\t\t\t\t{t('categoryDetail.thisWeek', { count: currentCount })}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"text-xs text-label\">{t('categoryDetail.baselineAvg', { avg: avgFormatted })}</div>\n\t\t\t\t{!isStable && (\n\t\t\t\t\t<div className=\"flex items-baseline gap-1.5 pt-1\">\n\t\t\t\t\t\t<span className=\"text-lg font-bold\" style={{ color }}>\n\t\t\t\t\t\t\t{changeText}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{deltaEventsText && <span className=\"text-xs text-label\">{deltaEventsText}</span>}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\n\t\t\t{/* Trend chart */}\n\t\t\t<CategoryTrendChart\n\t\t\t\tweeks={weeklyStats}\n\t\t\t\tbaselineAvg={baselineAvg}\n\t\t\t\tsentiment={sentiment}\n\t\t\t\tselectedWeekIndex={selectedWeekIndex}\n\t\t\t\tonSelectWeek={setSelectedWeekIndex}\n\t\t\t/>\n\n\t\t\t{/* Week history grid */}\n\t\t\t<WeekHistoryGrid\n\t\t\t\tweeks={weekHistoryData}\n\t\t\t\tcurrentWeekIndex={weeklyStats.length - 1}\n\t\t\t\tselectedWeekIndex={selectedWeekIndex}\n\t\t\t\tsentiment={sentiment}\n\t\t\t\tonSelectWeek={setSelectedWeekIndex}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n"],"names":["getISOWeek","date","d","yearStart","weekNumber","getWeekStartDate","year","week","simple","dow","ISOweekStart","getWeekKey","getLastNWeeks","count","weeks","today","i","key","start","end","w","getDaysElapsedInCurrentWeek","weekStart","now","diffMs","diffDays","isEntryInWeek","entry","weekEnd","entryDate","processFoodEntriesByWeek","entries","data","foodEntries","filterEntriesByType","foodCategories","getCategories","weekEntries","e","categoryMap","getEntryCategoryIds","catId","catName","getCategoryNameById","sentiment","c","existing","categories","sentimentCounts","s","calculateBalanceScore","weeklyData","positive","limit","getScoreChange","current","previous","change","getTopCategories","allWeeklyData","categoryTotals","cat","a","b","getChartColors","styles","buildCategoryColorMap","topCategoryIds","chartColors","map","index","groupCategoriesForWeek","grouped","otherCount","aIdx","bIdx","countCategoriesBySentiment","catIds","counts","total","last4","rangeStart","rangeEnd","entryCatIds","getWeekNumber","weekKey","match","getDailyBreakdown","dayLabels","jsDay","idx","day","getTopLimitCategories","share","getLaggingPositiveCategories","avgShare","gap","r","gapPercent","useIsMobile","breakpoint","subscribe","useCallback","cb","mql","getSnapshot","useSyncExternalStore","BalanceOverview","t","useTranslation","useMemo","neutral","formatWeekLabel","currentScore","previousScore","scoreChange","isMobile","jsxs","jsx","ResponsiveContainer","BarChart","XAxis","YAxis","Tooltip","value","Bar","Cell","MAX_DASHBOARD_CARDS","ActionableCategories","limitRows","positiveRows","followedIds","cardCount","handleFollow","categoryId","categoryName","showToast","addDashboardCard","Panel","title","subtitle","rows","accent","onFollow","followingLabel","followLabel","barColor","maxValue","row","isFollowed","barWidth","cn","CategoryComposition","modal","setModal","useState","colorMap","chartData","totalCategoryCount","sum","dataPoint","allCategoryIds","categoryNameMap","handleBarClick","Fragment","state","CategoryDetailModal","onClose","sortedCategories","percentage","color","SENTIMENT_COLORS","GoalCard","sparklineData","currentCount","baselineAvg","deltaPercent","daysElapsed","onRemove","onCardClick","isStable","absPercent","changeText","proratedBaseline","deltaEvents","raw","sign","abs","formatted","unit","avgFormatted","X","LineChart","ReferenceLine","Line","props","cx","cy","Dot","AddCategoryModal","dashboardCards","useDashboardCards","useFoodCategories","activityCategories","useActivityCategories","search","setSearch","addedCategoryIds","filteredCategories","term","handleSelect","category","isAdded","GoalDashboard","navigate","useNavigate","useTrackerData","isModalOpen","setIsModalOpen","currentWeek","dashboardData","card","foodCat","activityCat","range","formatDateLocal","filterEntriesByCategory","filterEntriesByDateRange","delta","item","removeDashboardCard","rankItems","itemLookup","rankCategories","catLookup","FrequencyRanking","timePeriod","setTimePeriod","typeFilter","setTypeFilter","viewMode","setViewMode","timeFilteredEntries","getDateNDaysAgo","getTodayDate","filteredEntries","ranked","maxCount","SegmentedControl","StatsPage","period","setPeriod","hasData","WeekBreakdownTooltip","dailyData","CategoryTrendChart","selectedWeekIndex","onSelectWeek","tooltipData","payload","isSelected","isLast","WeekHistoryGrid","currentWeekIndex","isCurrentWeek","getChangeColor","formatChange","percentChange","increaseIsBad","CategoryDetailPage","useParams","setSelectedWeekIndex","weeklyStats","weekHistoryData","prev","changeSign","deltaRaw","deltaFormatted","deltaUnit","deltaEventsText"],"mappings":"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"}