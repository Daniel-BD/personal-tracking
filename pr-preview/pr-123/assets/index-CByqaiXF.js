import{g as z,f as q,a as se,b as H,u as w,c as F,j as e,s as Z,d as ae,e as V,X as _,h as be,i as je,k as Ne,l as ne,m as Y,n as A,o as oe,p as X,r as Ce,q as we,t as ke,S as $,v as Me}from"./index-C_hlvjDw.js";import{b as h,e as O,B as re,X as G,Y as U,T as le,f as W,C as P,L as ce,h as ie,i as de,D as K}from"./recharts-DVTnlDRN.js";function ue(t){const s=new Date(t);s.setHours(0,0,0,0),s.setDate(s.getDate()+4-(s.getDay()||7));const a=new Date(s.getFullYear(),0,1),o=Math.ceil(((s.getTime()-a.getTime())/864e5+1)/7);return{year:s.getFullYear(),week:o}}function De(t,s){const a=new Date(t,0,1+(s-1)*7),o=a.getDay(),n=a;return o<=4?n.setDate(a.getDate()-a.getDay()+1):n.setDate(a.getDate()+8-a.getDay()),n}function Se(t){const{year:s,week:a}=ue(t);return`${s}-W${String(a).padStart(2,"0")}`}function R(t=8){const s=[],a=new Date;for(let o=t-1;o>=0;o--){const n=new Date(a);n.setDate(n.getDate()-o*7);const r=Se(n),u=De(n.getFullYear(),ue(n).week),c=new Date(u);c.setDate(c.getDate()+6),s.find(m=>m.key===r)||s.push({key:r,start:u,end:c})}return s}function me(t,s){const a=new Date;a.setHours(0,0,0,0);const o=new Date(t);o.setHours(0,0,0,0);const n=a.getTime()-o.getTime(),r=Math.floor(n/864e5)+1;return Math.max(1,Math.min(7,r))}function xe(t,s,a){const o=new Date(t.date+"T00:00:00");return o>=s&&o<=a}function Ie(t,s,a){const o=q(t,"food"),n=se(s,"food");return a.map(r=>{const u=o.filter(l=>xe(l,r.start,r.end)),c=new Map;u.forEach(l=>{H(l,s).forEach(x=>{const g=z(x,s),v=n.find(N=>N.id===x)?.sentiment??"neutral";c.has(x)||c.set(x,{categoryId:x,categoryName:g,sentiment:v,count:0});const j=c.get(x);j.count+=1})});const m=Array.from(c.values()),d={positive:m.filter(l=>l.sentiment==="positive").reduce((l,i)=>l+i.count,0),neutral:m.filter(l=>l.sentiment==="neutral").reduce((l,i)=>l+i.count,0),limit:m.filter(l=>l.sentiment==="limit").reduce((l,i)=>l+i.count,0)};return{weekKey:r.key,start:r.start,end:r.end,entries:u,totalCount:u.length,categories:m,sentimentCounts:d,hasLowData:u.length<5}})}function ee(t){const{positive:s,limit:a}=t.sentimentCounts;return s+a===0?0:s/(s+a)*100}function Te(t,s){if(s===0)return{direction:"stable",percentChange:0};const a=(t-s)/s*100;return Math.abs(a)<1?{direction:"stable",percentChange:0}:{direction:a>0?"up":"down",percentChange:Math.round(Math.abs(a))}}function Ee(t,s=9){const a=new Map;return t.forEach(o=>{o.categories.forEach(n=>{a.set(n.categoryId,(a.get(n.categoryId)||0)+n.count)})}),Array.from(a.entries()).sort((o,n)=>n[1]-o[1]).slice(0,s).map(([o])=>o)}function Le(){if(typeof document>"u")return["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#f97316","#6366f1"];const t=getComputedStyle(document.documentElement);return[t.getPropertyValue("--chart-color-1").trim(),t.getPropertyValue("--chart-color-2").trim(),t.getPropertyValue("--chart-color-3").trim(),t.getPropertyValue("--chart-color-4").trim(),t.getPropertyValue("--chart-color-5").trim(),t.getPropertyValue("--chart-color-6").trim(),t.getPropertyValue("--chart-color-7").trim(),t.getPropertyValue("--chart-color-8").trim(),t.getPropertyValue("--chart-color-9").trim()]}function $e(t){const s=Le(),a=new Map;return t.forEach((o,n)=>{a.set(o,s[n%s.length])}),a.set("OTHER","var(--color-neutral)"),a}function We(t,s){const a=[];let o=0;return t.categories.forEach(n=>{s.includes(n.categoryId)?a.push(n):o+=n.count}),o>0&&a.push({categoryId:"OTHER",categoryName:"Other",sentiment:"neutral",count:o}),a.sort((n,r)=>{const u=s.indexOf(n.categoryId),c=s.indexOf(r.categoryId);return u===-1?1:c===-1?-1:u-c})}function he(t,s,a,o){const n=se(s,"food"),r=new Set(n.filter(x=>x.sentiment===o).map(x=>x.id)),u=new Map;let c=0;if(r.size===0)return{counts:u,total:c,catIds:r};const m=a.slice(-4),d=m[0].start,l=m[m.length-1].end,i=q(t,"food").filter(x=>xe(x,d,l));for(const x of i){const g=H(x,s);for(const f of g)r.has(f)&&(u.set(f,(u.get(f)||0)+1),c++)}return{counts:u,total:c,catIds:r}}function ge(t){const s=t.match(/W(\d+)$/);return s?parseInt(s[1],10):0}function Pe(t,s,a){const o=["M","T","W","T","F","S","S"],n=[0,0,0,0,0,0,0];for(const r of t){const u=new Date(r.date+"T00:00:00");if(u>=s&&u<=a){const c=u.getDay(),m=c===0?6:c-1;n[m]++}}return o.map((r,u)=>({day:r,count:n[u]}))}function Ae(t,s,a,o=5){const{counts:n,total:r}=he(t,s,a,"limit");return r===0?[]:Array.from(n.entries()).sort((u,c)=>c[1]-u[1]).slice(0,o).map(([u,c])=>{const m=Math.round(c/r*100),d=z(u,s);return{categoryId:u,categoryName:d,value:m,label:`${m}% of limit total`,count:c}})}function Fe(t,s,a,o=5){const{counts:n,total:r,catIds:u}=he(t,s,a,"positive");if(r===0)return[];for(const m of u)n.has(m)||n.set(m,0);const c=1/u.size;return Array.from(n.entries()).map(([m,d])=>{const l=d/r,i=c-l;return{catId:m,count:d,share:l,gap:i}}).filter(m=>m.gap>0).sort((m,d)=>d.gap-m.gap).slice(0,o).map(m=>{const d=z(m.catId,s),l=Math.round(m.gap*100);return{categoryId:m.catId,categoryName:d,value:l,label:"Below your positive average"}})}function J(t=640){const s=h.useCallback(o=>{const n=window.matchMedia(`(max-width: ${t-1}px)`);return n.addEventListener("change",o),()=>n.removeEventListener("change",o)},[t]),a=h.useCallback(()=>window.matchMedia(`(max-width: ${t-1}px)`).matches,[t]);return h.useSyncExternalStore(s,a,()=>!1)}function Oe({weeklyData:t}){const{t:s}=w("stats"),a=h.useMemo(()=>t.map(c=>{const{positive:m,neutral:d,limit:l}=c.sentimentCounts,i=m+d+l;return{week:F(c.start),positive:i>0?m/i*100:0,neutral:i>0?d/i*100:0,limit:i>0?l/i*100:0,opacity:c.hasLowData?.4:1}}),[t]),o=h.useMemo(()=>t.length===0?0:ee(t[t.length-1]),[t]),n=h.useMemo(()=>t.length<2?o:ee(t[t.length-2]),[t,o]),r=h.useMemo(()=>Te(o,n),[o,n]),u=J();return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("balanceOverview.scoreTitle")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-4xl font-bold",style:{color:"var(--color-activity)"},children:[Math.round(o),"%"]}),r.direction!=="stable"&&e.jsxs("div",{className:"text-sm font-semibold flex items-center gap-1",style:{color:r.direction==="up"?"var(--color-success)":"var(--color-danger)"},children:[e.jsx("span",{children:r.direction==="up"?"↑":"↓"}),e.jsxs("span",{children:[r.percentChange,"%"]})]})]})]}),e.jsx("div",{className:"bg-[var(--bg-inset)] rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${o}%`,background:"linear-gradient(to right, var(--color-danger), var(--color-warning), var(--color-success))"}})}),e.jsx("p",{className:"text-xs text-body",children:s("balanceOverview.scoreMeterDescription")})]}),e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("balanceOverview.weeklyBreakdownTitle")}),e.jsx(O,{width:"100%",height:280,children:e.jsxs(re,{data:a,layout:"vertical",margin:u?{top:5,right:10,left:5,bottom:5}:{top:5,right:30,left:80,bottom:5},children:[e.jsx(G,{type:"number",domain:[0,100],hide:!0}),e.jsx(U,{dataKey:"week",type:"category",width:u?50:75,tick:{fontSize:12}}),e.jsx(le,{formatter:c=>c!==void 0?`${Math.round(c)}%`:"N/A",contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-default)",borderRadius:"8px"}}),e.jsx(W,{dataKey:"positive",stackId:"sentiment",fill:"var(--color-success)",name:s("balanceOverview.chartPositive"),children:a.map((c,m)=>e.jsx(P,{opacity:c.opacity},`positive-${m}`))}),e.jsx(W,{dataKey:"neutral",stackId:"sentiment",fill:"var(--color-neutral)",name:s("balanceOverview.chartNeutral"),children:a.map((c,m)=>e.jsx(P,{opacity:c.opacity},`neutral-${m}`))}),e.jsx(W,{dataKey:"limit",stackId:"sentiment",fill:"var(--color-danger)",name:s("balanceOverview.chartLimit"),children:a.map((c,m)=>e.jsx(P,{opacity:c.opacity},`limit-${m}`))})]})}),e.jsx("p",{className:"text-xs text-body",children:s("balanceOverview.lowDataWarning")})]})]})}const Re=6;function Be({data:t}){const{t:s}=w("stats"),a=h.useMemo(()=>R(8),[]),o=h.useMemo(()=>Ae(t.entries,t,a),[t,a]),n=h.useMemo(()=>Fe(t.entries,t,a),[t,a]),r=h.useMemo(()=>new Set((t.dashboardCards||[]).map(m=>m.categoryId)),[t.dashboardCards]),u=t.dashboardCards?.length??0;if(o.length===0&&n.length===0)return null;function c(m,d){if(!r.has(m)){if(u>=Re){Z(s("focusAreas.dashboardFull"));return}ae(m),Z(s("focusAreas.addedToDashboard",{name:d}))}}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-heading",children:s("focusAreas.title")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[o.length>0&&e.jsx(te,{title:s("focusAreas.limitPanel.title"),subtitle:s("focusAreas.limitPanel.subtitle"),rows:o,accent:"limit",followedIds:r,onFollow:c,followingLabel:s("focusAreas.following"),followLabel:s("focusAreas.follow")}),n.length>0&&e.jsx(te,{title:s("focusAreas.positivePanel.title"),subtitle:s("focusAreas.positivePanel.subtitle"),rows:n,accent:"positive",followedIds:r,onFollow:c,followingLabel:s("focusAreas.following"),followLabel:s("focusAreas.follow")})]})]})}function te({title:t,subtitle:s,rows:a,accent:o,followedIds:n,onFollow:r,followingLabel:u,followLabel:c}){const m=J(),d=o==="limit"?"var(--color-danger)":"var(--color-food)",l=Math.max(...a.map(i=>i.value),1);return e.jsxs("div",{className:"card p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-heading",children:t}),e.jsx("p",{className:"text-xs text-label mt-0.5",children:s})]}),e.jsx("div",{className:"space-y-2",children:a.map(i=>{const x=n.has(i.categoryId),g=Math.max(i.value/l*100,4);return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-heading truncate",children:i.categoryName}),e.jsx("span",{className:"text-xs text-label whitespace-nowrap",children:i.label})]}),e.jsx("button",{onClick:()=>r(i.categoryId,i.categoryName),disabled:x,className:V("text-xs font-medium px-2 py-0.5 rounded transition-colors whitespace-nowrap",x?"text-label cursor-default":"text-body hover:bg-[var(--bg-inset)]",!m&&!x&&"sm:opacity-0 sm:group-hover:opacity-100"),children:x?u:c})]}),e.jsx("div",{className:"h-2 rounded-full bg-[var(--bg-inset)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300",style:{width:`${g}%`,backgroundColor:d,opacity:.7}})})]},i.categoryId)})})]})}function Ke({weeklyData:t}){const[s,a]=h.useState({isOpen:!1,week:null}),o=h.useMemo(()=>Ee(t,9),[t]),n=h.useMemo(()=>$e(o),[o]),r=h.useMemo(()=>t.map(l=>{const i=We(l,o),x=i.reduce((f,v)=>f+v.count,0),g={week:F(l.start),weekKey:l.weekKey,opacity:l.hasLowData?.4:1};return i.forEach(f=>{g[f.categoryId]=x>0?f.count/x*100:0}),g}),[t,o]),u=h.useMemo(()=>[...o,"OTHER"],[o]),c=h.useMemo(()=>{const l=new Map;return t.forEach(i=>{i.categories.forEach(x=>{l.has(x.categoryId)||l.set(x.categoryId,x.categoryName)})}),l.set("OTHER","Other"),l},[t]),m=J(),d=l=>{const i=t.find(x=>x.weekKey===l.weekKey);i&&a({isOpen:!0,week:i})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card p-4 sm:p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Category Composition"}),e.jsx(O,{width:"100%",height:280,children:e.jsxs(re,{data:r,layout:"vertical",margin:m?{top:5,right:10,left:5,bottom:5}:{top:5,right:30,left:80,bottom:5},onClick:l=>{l.isTooltipActive&&typeof l.activeTooltipIndex=="number"&&d(r[l.activeTooltipIndex])},children:[e.jsx(G,{type:"number",domain:[0,100],hide:!0}),e.jsx(U,{dataKey:"week",type:"category",width:m?50:75,tick:{fontSize:12}}),e.jsx(le,{formatter:l=>l!==void 0?`${Math.round(l)}%`:"N/A",contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-default)",borderRadius:"8px"},cursor:{fill:"var(--bg-inset)"}}),u.map(l=>e.jsx(W,{dataKey:l,stackId:"categories",fill:n.get(l)||"var(--color-neutral)",name:c.get(l)||l,isAnimationActive:!1,children:r.map((i,x)=>e.jsx(P,{opacity:i.opacity,cursor:"pointer"},`${l}-${x}`))},l))]})}),e.jsx("p",{className:"text-xs text-body",children:"Click a bar to see detailed category breakdown"})]}),s.isOpen&&s.week&&e.jsx(ze,{week:s.week,colorMap:n,onClose:()=>a({isOpen:!1,week:null})})]})}function ze({week:t,colorMap:s,onClose:a}){const o=h.useMemo(()=>[...t.categories].sort((n,r)=>r.count-n.count),[t.categories]);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-end z-50 sm:items-center",children:[e.jsxs("div",{className:"bg-[var(--bg-elevated)] w-full sm:w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl p-6 space-y-4 max-h-96 overflow-y-auto",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b border-[var(--border-default)]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-heading",children:["Week of ",F(t.start)]}),e.jsxs("p",{className:"text-sm text-body",children:[t.totalCount," events"]})]}),e.jsx("button",{onClick:a,className:"text-label hover:text-heading text-xl",children:"✕"})]}),e.jsx("div",{className:"space-y-3",children:o.map(n=>{const r=t.totalCount>0?Math.round(n.count/t.totalCount*100):0,u=s.get(n.categoryId);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:u}}),e.jsx("span",{className:"font-medium truncate text-heading",children:n.categoryName})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-sm text-body",children:[r,"%"]}),e.jsxs("span",{className:"text-sm font-semibold text-heading",children:["(",n.count,")"]})]})]}),e.jsx("div",{className:"bg-[var(--bg-inset)] rounded h-1.5",children:e.jsx("div",{className:"h-full rounded transition-all",style:{width:`${r}%`,backgroundColor:u}})})]},n.categoryId)})})]}),e.jsx("div",{className:"fixed inset-0 -z-10",onClick:a})]})}const qe={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function He({categoryName:t,sentiment:s,sparklineData:a,currentCount:o,baselineAvg:n,deltaPercent:r,daysElapsed:u,onRemove:c,onCardClick:m}){const{t:d}=w("stats"),l=qe[s],i=Math.abs(r)<.1,x=Math.round(Math.abs(r)*100),g=h.useMemo(()=>i?d("goalCard.noMeaningfulChange"):`${r>0?"+":"−"}${x}%`,[i,r,x,d]),f=n*(u/7),v=h.useMemo(()=>{if(i)return null;const b=o-f,k=b>=0?"+":"−",p=Math.abs(b),C=Number.isInteger(p)?p.toString():p.toFixed(1),M=d("goalCard.event",{count:Math.round(p)});return`(${k}${C} ${M})`},[i,o,f,d]),j=o-n,N=n===0?o>0?1:0:j/n,T=Math.round(Math.abs(N)*100),S=`${N>0?"+":"−"}${T}%`,I=Number.isInteger(n)?n.toString():n.toFixed(1);return e.jsxs("div",{className:"card p-4 flex flex-col justify-between relative group h-full min-h-[160px] cursor-pointer active:scale-[0.98] transition-transform",onClick:m,role:"button",tabIndex:0,onKeyDown:b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),m?.())},children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),c()},className:"absolute top-2 right-2 p-1 text-label opacity-60 sm:opacity-0 group-hover:opacity-100 transition-opacity hover:text-[var(--color-danger)]",title:d("goalCard.removeFromDashboard"),children:e.jsx(_,{className:"w-4 h-4",strokeWidth:2})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:l}}),e.jsx("span",{className:"text-xs font-medium text-label truncate max-w-[120px]",children:t})]}),e.jsxs("div",{className:"mt-1.5 space-y-0",children:[e.jsxs("div",{className:"text-sm font-semibold text-heading",children:[d("goalCard.thisWeek",{count:o}),u<7&&e.jsxs("span",{className:"text-xs font-normal text-label",children:[" ",d("goalCard.partialWeek",{day:u})]})]}),e.jsx("div",{className:"text-xs text-label",children:d("goalCard.baselineAvg",{count:Math.round(n),avg:I})})]}),e.jsxs("div",{className:"mt-1 space-y-0.5",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-lg font-bold",style:{color:i?void 0:l},children:g}),v&&e.jsx("span",{className:"text-[10px] text-label",children:v}),!i&&u<7&&e.jsx("span",{className:"text-[10px] text-label",children:d("goalCard.projected")})]}),u<7&&e.jsx("div",{className:"text-[10px] text-[var(--text-tertiary)]",children:d("goalCard.currentlyLabel",{change:S})})]}),e.jsx("div",{className:"h-12 w-full -mx-2 mt-1",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ce,{data:a,children:[e.jsx(ie,{y:n,stroke:"var(--border-default)",strokeDasharray:"3 3",strokeWidth:1}),e.jsx(de,{type:"monotone",dataKey:"count",stroke:l,strokeWidth:2,dot:b=>{const{cx:k,cy:p,index:C}=b;return k==null||p==null||C==null?e.jsx(e.Fragment,{}):C===a.length-1?e.jsx(K,{cx:k,cy:p,r:4,fill:l,stroke:"var(--bg-card)",strokeWidth:2}):e.jsx(K,{cx:k,cy:p,r:2,fill:l,stroke:"none",opacity:.35})},isAnimationActive:!1})]})})})]})}function Ve({onClose:t}){const{t:s}=w("stats"),a=be(),o=je(),n=Ne(),[r,u]=h.useState(""),c=h.useMemo(()=>new Set(a.map(i=>i.categoryId)),[a]),m=h.useMemo(()=>[...o.map(x=>({...x,type:"food"})),...n.map(x=>({...x,type:"activity"}))].sort((x,g)=>x.name.localeCompare(g.name)),[o,n]),d=h.useMemo(()=>{const i=r.toLowerCase().trim();return m.filter(x=>x.name.toLowerCase().includes(i))},[m,r]),l=i=>{c.has(i)||(ae(i),t())};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"card w-full max-w-md bg-elevated shadow-elevated flex flex-col max-h-[80vh]",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:s("addCategoryModal.title")}),e.jsx("button",{onClick:t,className:"p-1 hover:bg-inset rounded-full transition-colors",children:e.jsx(_,{className:"w-5 h-5",strokeWidth:2})})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:s("addCategoryModal.searchPlaceholder"),className:"form-input",value:r,onChange:i=>u(i.target.value),autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:[d.map(i=>{const x=c.has(i.id);return e.jsxs("button",{onClick:()=>l(i.id),disabled:x,className:`w-full text-left px-3 py-2 rounded-md flex items-center justify-between transition-colors ${x?"opacity-50 cursor-not-allowed bg-inset":"hover:bg-inset"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i.type==="food"?"var(--color-food)":"var(--color-activity)"}}),e.jsx("span",{className:"font-medium",children:i.name}),e.jsx("span",{className:"text-xs text-label px-1.5 py-0.5 rounded-full bg-inset capitalize",children:i.type})]}),x&&e.jsx("span",{className:"text-xs font-medium text-label",children:s("addCategoryModal.added")})]},i.id)}),d.length===0&&e.jsx("div",{className:"py-8 text-center text-label",children:s("addCategoryModal.noResults",{search:r})})]})]}),e.jsx("div",{className:"fixed inset-0 -z-10",onClick:t})]})}function _e(){const{t}=w("stats"),s=ne(),a=Y(),[o,n]=h.useState(!1),r=h.useMemo(()=>R(8),[a.entries]),u=r[r.length-1],c=u?me(u.start):7,m=h.useMemo(()=>a.dashboardCards?a.dashboardCards.map(d=>{const l=d.categoryId,i=a.foodCategories.find(p=>p.id===l),x=a.activityCategories.find(p=>p.id===l),g=i||x;if(!g)return null;const f=g.name,v=g.sentiment,j=r.map(p=>{const C={start:A(p.start),end:A(p.end)},M=oe(X(a.entries,C),l,a);return{week:p.key,count:M.length}}),N=j[j.length-1].count,S=j.slice(3,7).reduce((p,C)=>p+C.count,0)/4,I=S*(c/7),b=N-I,k=I===0?N>0?1:0:b/I;return{categoryId:l,categoryName:f,sentiment:v,sparklineData:j,currentCount:N,baselineAvg:S,deltaPercent:k,daysElapsed:c}}).filter(d=>d!==null):[],[a,r,c]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-heading",children:t("goalDashboard.title")}),e.jsx("button",{onClick:()=>n(!0),className:"text-sm font-medium transition-colors hover:opacity-80",style:{color:"var(--color-activity)"},children:t("goalDashboard.addToDashboard")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 overflow-y-auto pr-1",style:{maxHeight:"calc(3 * 180px + 2 * 1rem)"},children:[m.map(d=>e.jsx(He,{categoryName:d.categoryName,sentiment:d.sentiment,sparklineData:d.sparklineData,currentCount:d.currentCount,baselineAvg:d.baselineAvg,deltaPercent:d.deltaPercent,daysElapsed:d.daysElapsed,onRemove:()=>Ce(d.categoryId),onCardClick:()=>s(`/stats/category/${d.categoryId}`)},d.categoryId)),m.length===0&&e.jsxs("div",{className:"col-span-full py-8 text-center card bg-inset border-dashed",children:[e.jsx("p",{className:"text-label text-sm",children:t("goalDashboard.noDashboardCards")}),e.jsx("button",{onClick:()=>n(!0),className:"mt-2 text-sm font-semibold",style:{color:"var(--color-activity)"},children:t("goalDashboard.addFirstCategory")})]})]}),o&&e.jsx(Ve,{onClose:()=>n(!1)})]})}function Ye(t,s){const a=new Map([...s.activityItems,...s.foodItems].map(n=>[n.id,n])),o=new Map;for(const n of t){const r=o.get(n.itemId);if(r)r.count++;else{const u=a.get(n.itemId);o.set(n.itemId,{id:n.itemId,name:u?.name??"Unknown",count:1,type:n.type})}}return Array.from(o.values()).sort((n,r)=>r.count-n.count)}function Xe(t,s){const a=new Map([...s.activityCategories,...s.foodCategories].map(n=>[n.id,n])),o=new Map;for(const n of t){const r=H(n,s);for(const u of r){const c=o.get(u);if(c)c.count++;else{const m=a.get(u);o.set(u,{id:u,name:m?.name??"Unknown",count:1,type:n.type})}}}return Array.from(o.values()).sort((n,r)=>r.count-n.count)}function Ge({entries:t,data:s}){const{t:a}=w("stats"),[o,n]=h.useState("all"),[r,u]=h.useState("all"),[c,m]=h.useState("items"),d=h.useMemo(()=>o==="all"?t:X(t,{start:ke((o==="7d"?7:30)-1),end:we()}),[t,o]),l=h.useMemo(()=>r==="all"?d:q(d,r),[d,r]),i=h.useMemo(()=>c==="items"?Ye(l,s):Xe(l,s),[l,s,c]),x=i.length>0?i[0].count:0;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-heading",children:a("frequencyRanking.title")}),e.jsx($,{options:[{value:"all",label:a("frequencyRanking.timePeriod.all")},{value:"7d",label:a("frequencyRanking.timePeriod.7d")},{value:"30d",label:a("frequencyRanking.timePeriod.30d")}],value:o,onChange:n,variant:"segment",size:"sm"}),e.jsx($,{options:[{value:"all",label:a("frequencyRanking.typeFilter.all"),activeClass:"bg-[var(--text-secondary)] text-white"},{value:"activity",label:a("frequencyRanking.typeFilter.activities"),activeClass:"type-activity"},{value:"food",label:a("frequencyRanking.typeFilter.food"),activeClass:"type-food"}],value:r,onChange:u,variant:"segment",size:"sm"}),e.jsx($,{options:[{value:"items",label:a("frequencyRanking.viewMode.items")},{value:"categories",label:a("frequencyRanking.viewMode.categories")}],value:c,onChange:m,variant:"segment",size:"sm"}),i.length===0?e.jsx("p",{className:"text-sm text-label text-center py-4",children:a("frequencyRanking.empty",{viewMode:a(`frequencyRanking.viewMode.${c}`).toLowerCase()})}):e.jsx("div",{className:"space-y-1.5",children:i.map((g,f)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted w-5 text-right shrink-0",children:f+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsx("span",{className:"text-sm text-heading truncate",children:g.name}),e.jsx("span",{className:"text-xs text-label shrink-0",children:g.count})]}),e.jsx("div",{className:"h-1 rounded-full bg-[var(--bg-inset)] overflow-hidden",children:e.jsx("div",{className:V("h-full rounded-full transition-all",g.type==="activity"?"bg-[var(--color-activity)]":"bg-[var(--color-food)]"),style:{width:`${g.count/x*100}%`}})})]})]},g.id))})]})}function ct(){const{t}=w("stats"),s=Y(),[a,o]=h.useState("weekly"),n=h.useMemo(()=>R(8),[]),r=h.useMemo(()=>Ie(s.entries,s,n),[s,n]),u=h.useMemo(()=>r.some(c=>c.totalCount>0),[r]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("title")}),e.jsx("p",{className:"text-body",children:t("subtitle")})]}),e.jsx($,{options:[{value:"weekly",label:t("period.weekly")},{value:"monthly",label:t("period.monthly"),disabled:!0,title:t("period.monthlyComingSoon")}],value:a,onChange:o,variant:"segment",size:"sm"}),!u&&e.jsxs("div",{className:"card p-8 text-center space-y-2",children:[e.jsx("p",{className:"text-body",children:t("empty.noFoodEntries")}),e.jsx("p",{className:"text-sm text-label",children:t("empty.startLogging")})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{}),e.jsx("hr",{className:"border-[var(--border-default)]"}),e.jsx(Oe,{weeklyData:r}),e.jsx(Be,{data:s}),e.jsx(Ke,{weeklyData:r})]}),s.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-[var(--border-default)]"}),e.jsx(Ge,{entries:s.entries,data:s})]})]})}const Ue={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Je({weekNumber:t,total:s,dailyData:a,sentiment:o}){const{t:n}=w("stats"),r=Ue[o],u=Math.max(...a.map(c=>c.count),1);return e.jsxs("div",{className:"card p-3 space-y-2 shadow-[var(--shadow-elevated)]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{className:"text-sm font-semibold text-heading",children:n("categoryDetail.weekBreakdownTitle",{week:t})}),e.jsx("span",{className:"text-xs text-label",children:n("categoryDetail.weekBreakdownTotal",{count:s})})]}),e.jsx("div",{className:"flex items-end justify-between gap-1 h-20",children:a.map((c,m)=>{const d=u>0?c.count/u*100:0;return e.jsxs("div",{className:"flex flex-col items-center flex-1 h-full",children:[e.jsx("div",{className:"flex-1 flex items-end w-full",children:e.jsx("div",{className:"w-full rounded-t-[3px] min-h-[4px]",style:{height:`${Math.max(d,6)}%`,backgroundColor:c.count>0?r:"var(--bg-inset)",opacity:c.count>0?.4+c.count/u*.6:.3}})}),e.jsx("span",{className:"text-[11px] font-semibold mt-1 text-heading",children:c.count}),e.jsx("span",{className:"text-[11px] text-[var(--text-tertiary)] leading-tight",children:c.day})]},m)})})]})}const Qe={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function Ze({weeks:t,baselineAvg:s,sentiment:a,selectedWeekIndex:o,onSelectWeek:n}){const r=Qe[a],u=h.useMemo(()=>t.map(d=>({label:F(d.start),count:d.count})),[t]),c=h.useMemo(()=>Math.max(...t.map(d=>d.count),s,1),[t,s]),m=h.useMemo(()=>{if(o===null||!t[o])return null;const d=t[o];return{weekNumber:ge(d.weekKey),total:d.count,dailyData:Pe(d.entries,d.start,d.end)}},[o,t]);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-48 w-full -mx-2",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ce,{data:u,margin:{top:24,right:16,left:8,bottom:4},onClick:d=>{const l=typeof d?.activeTooltipIndex=="number"?d.activeTooltipIndex:null;l!==null&&n(l===o?null:l)},children:[e.jsx(G,{dataKey:"label",tickLine:!1,axisLine:!1,tick:{fontSize:11,fill:"var(--text-tertiary)"}}),e.jsx(U,{hide:!0,domain:[0,Math.ceil(c*1.2)]}),e.jsx(ie,{y:s,stroke:"var(--border-default)",strokeDasharray:"4 4",strokeWidth:1}),e.jsx(de,{type:"monotone",dataKey:"count",stroke:r,strokeWidth:2.5,isAnimationActive:!1,dot:d=>{const{cx:l,cy:i,index:x,payload:g}=d;if(l==null||i==null||x==null)return e.jsx("g",{});const f=x===o,v=x===t.length-1,j=f||v?5:3;return e.jsxs("g",{children:[e.jsx(K,{cx:l,cy:i,r:j,fill:f||v?r:"var(--bg-card)",stroke:r,strokeWidth:2}),e.jsx("text",{x:l,y:i-12,textAnchor:"middle",fontSize:11,fontWeight:600,fill:"var(--text-secondary)",children:g?.count})]})},activeDot:!1})]})})}),m&&e.jsx(Je,{weekNumber:m.weekNumber,total:m.total,dailyData:m.dailyData,sentiment:a})]})}const et={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function tt({weeks:t,currentWeekIndex:s,selectedWeekIndex:a,sentiment:o,onSelectWeek:n}){const{t:r}=w("stats"),u=et[o];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-heading",children:r("categoryDetail.last8Weeks")}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:t.map((c,m)=>{const d=m===s,l=m===a;return e.jsxs("button",{onClick:()=>n(m),className:V("card px-2 py-2.5 flex flex-col items-center text-center transition-all",l&&"ring-1"),style:{borderLeftWidth:d?"3px":void 0,borderLeftColor:d?u:void 0,"--tw-ring-color":l?u:void 0},children:[e.jsx("div",{className:"text-[11px] font-medium text-label",children:r("categoryDetail.weekLabel",{week:c.weekNumber})}),e.jsx("div",{className:"text-base font-bold text-heading",children:c.count}),e.jsx("div",{className:"text-[11px] font-medium",style:{color:st(c.percentChange,o)},children:at(c.percentChange)})]},c.weekNumber)})})]})}function st(t,s){if(t===null||t===0)return"var(--text-muted)";if(s==="neutral")return"var(--text-secondary)";const a=s==="limit";return t>0?a?"var(--color-danger)":"var(--color-success)":a?"var(--color-success)":"var(--color-danger)"}function at(t){return t===null?"--":t===0?"0%":`${t>0?"+":""}${Math.round(t)}%`}const nt={positive:"var(--color-success)",limit:"var(--color-danger)",neutral:"var(--color-neutral)"};function it(){const{categoryId:t}=Me(),s=ne(),{t:a}=w("stats"),o=Y(),[n,r]=h.useState(null),u=h.useMemo(()=>R(8),[o.entries]),c=u[u.length-1],m=c?me(c.start):7,d=h.useMemo(()=>o.foodCategories.find(y=>y.id===t)||o.activityCategories.find(y=>y.id===t),[o.foodCategories,o.activityCategories,t]),l=h.useMemo(()=>t?u.map(y=>{const L={start:A(y.start),end:A(y.end)},D=oe(X(o.entries,L),t,o);return{weekKey:y.key,label:y.key,count:D.length,start:y.start,end:y.end,entries:D}}):[],[u,t,o]),i=h.useMemo(()=>l.slice(3,7).reduce((D,B)=>D+B.count,0)/4,[l]),x=l.length>0?l[l.length-1].count:0,g=i*(m/7),f=x-g,v=g===0?x>0?1:0:f/g,j=Math.abs(v)<.1,N=x-i,T=i===0?x>0?1:0:N/i,E=d?.sentiment??"neutral",S=nt[E],I=h.useMemo(()=>l.map((y,L)=>{const D=L>0?l[L-1].count:null,B=D===null?null:D===0?y.count>0?100:0:(y.count-D)/D*100;return{weekNumber:ge(y.weekKey),count:y.count,percentChange:B}}),[l]);if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-4",children:[e.jsx("p",{className:"text-label",children:a("categoryDetail.notFound")}),e.jsx("button",{onClick:()=>s("/stats"),className:"btn btn-secondary btn-sm",children:a("categoryDetail.goBack")})]});const b=Number.isInteger(i)?i.toString():i.toFixed(1),k=Math.round(Math.abs(v)*100),p=v>0?"+":"−",C=j?"":`${p}${k}%`,M=Math.abs(f),fe=Number.isInteger(M)?M.toString():M.toFixed(1),pe=a("categoryDetail.event",{count:Math.round(M)}),Q=j?null:`(${p}${fe} ${pe})`,ye=Math.round(Math.abs(T)*100),ve=`${T>0?"+":"−"}${ye}%`;return e.jsxs("div",{className:"space-y-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:S}}),e.jsx("h1",{className:"text-xl font-bold text-heading",children:d.name})]}),e.jsx("button",{onClick:()=>s("/stats"),className:"p-2 -mr-2 text-label hover:text-heading transition-colors",children:e.jsx(_,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"card p-4 space-y-1",children:[e.jsxs("div",{className:"text-sm font-semibold text-heading",children:[a("categoryDetail.thisWeek",{count:x}),m<7&&e.jsxs("span",{className:"text-xs font-normal text-label",children:[" ","(",a("categoryDetail.partialWeek",{day:m}),")"]})]}),e.jsx("div",{className:"text-xs text-label",children:a("categoryDetail.baselineAvg",{avg:b})}),!j&&e.jsxs("div",{className:"flex items-baseline gap-1.5 pt-1",children:[e.jsx("span",{className:"text-lg font-bold",style:{color:S},children:C}),Q&&e.jsx("span",{className:"text-xs text-label",children:Q}),m<7&&e.jsx("span",{className:"text-[10px] text-label",children:a("categoryDetail.projected")})]}),m<7&&e.jsx("div",{className:"text-[11px] text-[var(--text-tertiary)]",children:a("categoryDetail.currentlyLabel",{change:ve})})]}),e.jsx(Ze,{weeks:l,baselineAvg:i,sentiment:E,selectedWeekIndex:n,onSelectWeek:r}),e.jsx(tt,{weeks:I,currentWeekIndex:l.length-1,selectedWeekIndex:n,sentiment:E,onSelectWeek:r})]})}export{Be as ActionableCategories,Ve as AddCategoryModal,Oe as BalanceOverview,Ke as CategoryComposition,it as CategoryDetailPage,Ge as FrequencyRanking,He as GoalCard,_e as GoalDashboard,ct as StatsPage};
